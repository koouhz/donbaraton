import{u as X,r as i,s as h,j as e,W as w,P as Y,C as A,i as T,X as R,E as $,b as Q}from"./index-DyRGlXyn.js";import{n as L,F as Z,L as O}from"./index-Bk6qzOxF.js";import{T as y}from"./triangle-alert-DqqKGNFw.js";import{R as ee}from"./refresh-cw-VSjeutiz.js";import{D as te}from"./dollar-sign-BJpoOmkd.js";import{F as oe}from"./file-text-CuqINRXR.js";import{S as se}from"./search-BOAzkQOY.js";import{T as ie}from"./trending-up-CNeeSLoG.js";import{C as g,a as E}from"./circle-arrow-up-BVPYWUEc.js";function ge(){const D=X(),[r,M]=i.useState([]),[W,V]=i.useState([]),[N,F]=i.useState([]),[b,P]=i.useState([]),[u,v]=i.useState(!0),[x,S]=i.useState(""),[m,k]=i.useState(""),[n,p]=i.useState(""),[J,j]=i.useState(!1),[l,K]=i.useState(null),[C,z]=i.useState([]),[G,B]=i.useState(!1);i.useEffect(()=>{I()},[]);const I=async()=>{v(!0);try{const[o,s,a,d]=await Promise.all([h.rpc("fn_leer_productos",{p_buscar:null,p_categoria_id:null}),h.rpc("fn_leer_categorias"),h.rpc("fn_alerta_stock_bajo"),h.rpc("fn_reporte_inventario_valorado")]);if(o.error)throw o.error;if(s.error)throw s.error;M(o.data||[]),V(s.data||[]),F(a.data||[]),P(d.data||[])}catch(o){console.error("Error:",o),L.error("Error al cargar inventario")}finally{v(!1)}},H=async o=>{K(o),j(!0),B(!0);try{const s=o.id_producto||o.id,{data:a,error:d}=await h.from("movimientos_inventario").select(`
          id_movimiento,
          tipo,
          cantidad,
          lote,
          fecha_vencimiento,
          documento,
          motivo,
          observaciones,
          fecha_hora,
          id_usuario
        `).eq("id_producto",s).order("fecha_hora",{ascending:!1}).limit(20);if(d)throw d;z(a||[])}catch(s){console.error("Error cargando movimientos:",s),L.error("Error al cargar el kardex del producto"),z([])}finally{B(!1)}},_=r.filter(o=>{const s=!x||o.nombre?.toLowerCase().includes(x.toLowerCase())||o.codigo_interno?.toLowerCase().includes(x.toLowerCase()),a=!m||o.categoria===m,d=!n||o.estado_stock===n;return s&&a&&d}),c={total:r.length,critico:r.filter(o=>o.estado_stock==="CRITICO").length,bajo:r.filter(o=>o.estado_stock==="BAJO").length,normal:r.filter(o=>o.estado_stock==="NORMAL").length,sobrestock:r.filter(o=>o.estado_stock==="SOBRESTOCK").length,valorTotal:r.reduce((o,s)=>o+(s.stock_actual||0)*(s.precio_venta||0),0),alertasActivas:N.length},U=o=>{const s={CRITICO:{bg:"#ffebee",color:"#c62828",icon:e.jsx(y,{size:14}),label:"Sin Stock"},BAJO:{bg:"#fff3e0",color:"#e65100",icon:e.jsx(A,{size:14}),label:"Stock Bajo"},NORMAL:{bg:"#e8f5e9",color:"#2e7d32",icon:e.jsx(T,{size:14}),label:"Normal"},SOBRESTOCK:{bg:"#e3f2fd",color:"#1565c0",icon:e.jsx(ie,{size:14}),label:"Sobrestock"}};return s[o]||s.NORMAL},f=o=>new Intl.NumberFormat("es-BO",{minimumFractionDigits:2,maximumFractionDigits:2}).format(o||0),q=o=>({ENTRADA:{icon:e.jsx(E,{size:16}),color:"#2e7d32",label:"Entrada"},SALIDA:{icon:e.jsx(g,{size:16}),color:"#c62828",label:"Salida"},"AJUSTE+":{icon:e.jsx(E,{size:16}),color:"#1565c0",label:"Ajuste +"},"AJUSTE-":{icon:e.jsx(g,{size:16}),color:"#e65100",label:"Ajuste -"},VENTA:{icon:e.jsx(g,{size:16}),color:"#c62828",label:"Venta"},MERMA:{icon:e.jsx(g,{size:16}),color:"#d32f2f",label:"Merma"},DA칌O:{icon:e.jsx(g,{size:16}),color:"#d32f2f",label:"Da침o"}})[o]||{icon:null,color:"#6c757d",label:o};return e.jsxs("div",{style:t.container,children:[e.jsx(Z,{position:"top-right"}),e.jsxs("header",{style:t.header,children:[e.jsxs("div",{children:[e.jsxs("h1",{style:t.title,children:[e.jsx(w,{size:28,style:{marginRight:"12px"}}),"Control de Inventario"]}),e.jsx("p",{style:t.subtitle,children:"Gesti칩n de stock y movimientos en tiempo real"})]}),e.jsxs("div",{style:t.headerActions,children:[c.alertasActivas>0&&e.jsxs("button",{style:t.alertButton,onClick:()=>D("/alertas-stock"),children:[e.jsx(y,{size:18}),"Ver Alertas (",c.alertasActivas,")"]}),e.jsx("button",{style:t.refreshButton,onClick:I,disabled:u,children:e.jsx(ee,{size:18,style:{animation:u?"spin 1s linear infinite":"none"}})})]})]}),e.jsxs("div",{style:t.statsGrid,children:[e.jsxs("div",{style:{...t.statCard,borderTop:"4px solid #1a5d1a"},children:[e.jsx(Y,{size:24,style:{color:"#1a5d1a",marginBottom:"10px"}}),e.jsx("span",{style:t.statValue,children:c.total}),e.jsx("span",{style:t.statLabel,children:"Total Productos"})]}),e.jsxs("div",{style:{...t.statCard,borderTop:"4px solid #c62828",cursor:"pointer"},onClick:()=>p(n==="CRITICO"?"":"CRITICO"),children:[e.jsx(y,{size:24,style:{color:"#c62828",marginBottom:"10px"}}),e.jsx("span",{style:{...t.statValue,color:"#c62828"},children:c.critico}),e.jsx("span",{style:t.statLabel,children:"Sin Stock"})]}),e.jsxs("div",{style:{...t.statCard,borderTop:"4px solid #e65100",cursor:"pointer"},onClick:()=>p(n==="BAJO"?"":"BAJO"),children:[e.jsx(A,{size:24,style:{color:"#e65100",marginBottom:"10px"}}),e.jsx("span",{style:{...t.statValue,color:"#e65100"},children:c.bajo}),e.jsx("span",{style:t.statLabel,children:"Stock Bajo"})]}),e.jsxs("div",{style:{...t.statCard,borderTop:"4px solid #2e7d32",cursor:"pointer"},onClick:()=>p(n==="NORMAL"?"":"NORMAL"),children:[e.jsx(T,{size:24,style:{color:"#2e7d32",marginBottom:"10px"}}),e.jsx("span",{style:{...t.statValue,color:"#2e7d32"},children:c.normal}),e.jsx("span",{style:t.statLabel,children:"Normal"})]}),e.jsxs("div",{style:{...t.statCard,borderTop:"4px solid #1565c0"},children:[e.jsx(te,{size:24,style:{color:"#1565c0",marginBottom:"10px"}}),e.jsxs("span",{style:{...t.statValue,color:"#1565c0",fontSize:"18px"},children:["Bs ",f(c.valorTotal)]}),e.jsx("span",{style:t.statLabel,children:"Valor Inventario"})]})]}),b.length>0&&e.jsxs("div",{style:t.categoriaResumen,children:[e.jsxs("h3",{style:t.seccionTitulo,children:[e.jsx(oe,{size:18}),"Inventario por Categor칤a"]}),e.jsx("div",{style:t.categoriaGrid,children:b.slice(0,4).map((o,s)=>e.jsxs("div",{style:t.categoriaCard,children:[e.jsx("span",{style:t.categoriaNombre,children:o.categoria}),e.jsxs("div",{style:t.categoriaStats,children:[e.jsxs("span",{children:[e.jsx("strong",{children:o.cantidad_productos})," productos"]}),e.jsxs("span",{children:[e.jsx("strong",{children:o.stock_total})," unids."]}),e.jsx("span",{style:{color:"#1a5d1a"},children:e.jsxs("strong",{children:["Bs ",f(o.valor_venta_potencial)]})})]})]},s))})]}),e.jsxs("div",{style:t.toolbar,children:[e.jsxs("div",{style:t.searchBox,children:[e.jsx(se,{size:18,style:{color:"#6c757d"}}),e.jsx("input",{type:"text",placeholder:"Buscar producto...",value:x,onChange:o=>S(o.target.value),style:t.searchInput}),x&&e.jsx("button",{onClick:()=>S(""),style:t.clearButton,children:e.jsx(R,{size:16})})]}),e.jsxs("select",{value:m,onChange:o=>k(o.target.value),style:t.select,children:[e.jsx("option",{value:"",children:"Todas las categor칤as"}),W.map(o=>e.jsx("option",{value:o.nombre,children:o.nombre},o.id))]}),e.jsxs("select",{value:n,onChange:o=>p(o.target.value),style:t.select,children:[e.jsx("option",{value:"",children:"Todos los estados"}),e.jsx("option",{value:"CRITICO",children:"游댮 Sin Stock"}),e.jsx("option",{value:"BAJO",children:"游 Stock Bajo"}),e.jsx("option",{value:"NORMAL",children:"游릭 Normal"}),e.jsx("option",{value:"SOBRESTOCK",children:"游댯 Sobrestock"})]}),(m||n)&&e.jsx("button",{style:t.clearFiltersButton,onClick:()=>{k(""),p("")},children:"Limpiar filtros"})]}),e.jsx("div",{style:t.tableContainer,children:u?e.jsxs("div",{style:t.loadingState,children:[e.jsx(O,{size:40,style:{animation:"spin 1s linear infinite",color:"#1a5d1a"}}),e.jsx("p",{children:"Cargando inventario..."})]}):_.length===0?e.jsxs("div",{style:t.emptyState,children:[e.jsx(w,{size:48,style:{color:"#ccc"}}),e.jsx("p",{children:"No se encontraron productos"})]}):e.jsxs("table",{style:t.table,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:t.th,children:"C칩digo"}),e.jsx("th",{style:t.th,children:"Producto"}),e.jsx("th",{style:t.th,children:"Categor칤a"}),e.jsx("th",{style:t.th,children:"Stock Actual"}),e.jsx("th",{style:t.th,children:"Stock M칤n."}),e.jsx("th",{style:t.th,children:"Estado"}),e.jsx("th",{style:t.th,children:"Valor Stock"}),e.jsx("th",{style:{...t.th,textAlign:"center"},children:"Acciones"})]})}),e.jsx("tbody",{children:_.map(o=>{const s=U(o.estado_stock),a=(o.stock_actual||0)*(o.precio_venta||0);return e.jsxs("tr",{style:{...t.tr,background:o.estado_stock==="CRITICO"?"#fff5f5":o.estado_stock==="BAJO"?"#fffbf0":"white"},children:[e.jsx("td",{style:t.td,children:e.jsx("code",{style:t.code,children:o.codigo_interno})}),e.jsx("td",{style:t.td,children:e.jsxs("div",{children:[e.jsx("strong",{children:o.nombre}),o.marca&&e.jsx("span",{style:t.marca,children:o.marca})]})}),e.jsx("td",{style:t.td,children:o.categoria||"-"}),e.jsx("td",{style:t.td,children:e.jsx("span",{style:{fontSize:"18px",fontWeight:"700",color:o.stock_actual<=0?"#c62828":o.stock_actual<=o.stock_minimo?"#e65100":"#1a5d1a"},children:o.stock_actual})}),e.jsx("td",{style:t.td,children:e.jsx("span",{style:{color:"#6c757d"},children:o.stock_minimo})}),e.jsx("td",{style:t.td,children:e.jsxs("span",{style:{...t.badge,background:s.bg,color:s.color},children:[s.icon,s.label]})}),e.jsx("td",{style:t.td,children:e.jsxs("strong",{children:["Bs ",f(a)]})}),e.jsx("td",{style:{...t.td,textAlign:"center"},children:e.jsxs("button",{style:t.viewButton,onClick:()=>H(o),title:"Ver Kardex",children:[e.jsx($,{size:16}),"Kardex"]})})]},o.id)})})]})}),J&&l&&e.jsx("div",{style:t.modalOverlay,onClick:()=>j(!1),children:e.jsxs("div",{style:t.modal,onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{style:t.modalHeader,children:[e.jsxs("div",{children:[e.jsx("h2",{style:t.modalTitle,children:"Kardex del Producto"}),e.jsxs("p",{style:t.modalSubtitle,children:[l.codigo_interno," - ",l.nombre]})]}),e.jsx("button",{style:t.closeButton,onClick:()=>j(!1),children:e.jsx(R,{size:20})})]}),e.jsxs("div",{style:t.modalBody,children:[e.jsxs("div",{style:t.productoInfo,children:[e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"Stock Actual"}),e.jsx("span",{style:t.infoValue,children:l.stock_actual})]}),e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"Stock M칤nimo"}),e.jsx("span",{style:t.infoValue,children:l.stock_minimo})]}),e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"Precio Venta"}),e.jsxs("span",{style:t.infoValue,children:["Bs ",f(l.precio_venta)]})]}),e.jsxs("div",{style:t.infoItem,children:[e.jsx("span",{style:t.infoLabel,children:"Categor칤a"}),e.jsx("span",{style:t.infoValue,children:l.categoria||"-"})]})]}),e.jsxs("h3",{style:t.seccionTitulo,children:[e.jsx(Q,{size:18}),"칔ltimos Movimientos"]}),G?e.jsx("div",{style:t.loadingState,children:e.jsx(O,{size:30,style:{animation:"spin 1s linear infinite",color:"#1a5d1a"}})}):C.length===0?e.jsx("div",{style:t.emptyMovimientos,children:e.jsx("p",{children:"No hay movimientos registrados"})}):e.jsx("div",{style:t.movimientosLista,children:C.map((o,s)=>{const a=q(o.tipo);return e.jsxs("div",{style:t.movimientoItem,children:[e.jsx("div",{style:{...t.movimientoIcono,background:`${a.color}15`,color:a.color},children:a.icon}),e.jsxs("div",{style:t.movimientoInfo,children:[e.jsxs("div",{style:t.movimientoTipo,children:[e.jsx("strong",{children:a.label}),e.jsxs("span",{style:{...t.movimientoCantidad,color:o.tipo.includes("ENTRADA")||o.tipo.includes("+")?"#2e7d32":"#c62828"},children:[o.tipo.includes("ENTRADA")||o.tipo.includes("+")?"+":"-",o.cantidad," unids."]})]}),e.jsxs("div",{style:t.movimientoMeta,children:[e.jsx("span",{style:{fontWeight:"500",color:"#333"},children:o.motivo||o.tipo||"Sin motivo"}),o.documento&&e.jsx("span",{style:{background:"#e9ecef",padding:"2px 6px",borderRadius:"4px",fontSize:"11px",fontFamily:"monospace"},children:o.documento})]}),o.observaciones&&e.jsxs("p",{style:{margin:"4px 0 0 0",fontSize:"12px",color:"#6c757d",fontStyle:"italic"},children:['"',o.observaciones,'"']}),e.jsxs("div",{style:{display:"flex",gap:"15px",marginTop:"6px",fontSize:"11px",color:"#999"},children:[e.jsx("span",{children:new Date(o.fecha_hora).toLocaleDateString("es-BO")}),e.jsx("span",{children:new Date(o.fecha_hora).toLocaleTimeString("es-BO",{hour:"2-digit",minute:"2-digit"})}),o.lote&&e.jsxs("span",{children:["Lote: ",o.lote]})]})]})]},o.id_movimiento||s)})})]})]})}),e.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]})}const t={container:{padding:"20px",maxWidth:"1400px",margin:"0 auto"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px",flexWrap:"wrap",gap:"15px"},title:{margin:0,fontSize:"28px",fontWeight:"700",color:"#1a5d1a",display:"flex",alignItems:"center"},subtitle:{margin:"8px 0 0 0",color:"#6c757d",fontSize:"14px"},headerActions:{display:"flex",gap:"10px"},alertButton:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 16px",background:"#fff3e0",color:"#e65100",border:"1px solid #ffcc80",borderRadius:"10px",fontSize:"14px",fontWeight:"500",cursor:"pointer"},refreshButton:{padding:"10px",background:"white",border:"1px solid #e9ecef",borderRadius:"10px",cursor:"pointer",color:"#6c757d"},statsGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:"15px",marginBottom:"20px"},statCard:{background:"white",padding:"20px",borderRadius:"12px",textAlign:"center",boxShadow:"0 2px 8px rgba(0,0,0,0.05)",transition:"transform 0.2s"},statValue:{fontSize:"28px",fontWeight:"700",color:"#1a5d1a",display:"block"},statLabel:{fontSize:"13px",color:"#6c757d",marginTop:"5px",display:"block"},categoriaResumen:{background:"white",borderRadius:"12px",padding:"20px",marginBottom:"20px",boxShadow:"0 2px 8px rgba(0,0,0,0.05)"},seccionTitulo:{display:"flex",alignItems:"center",gap:"10px",margin:"0 0 15px 0",fontSize:"16px",fontWeight:"600",color:"#1a5d1a"},categoriaGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"12px"},categoriaCard:{background:"#f8f9fa",borderRadius:"10px",padding:"15px",border:"1px solid #e9ecef"},categoriaNombre:{display:"block",fontWeight:"600",color:"#333",marginBottom:"8px"},categoriaStats:{display:"flex",flexDirection:"column",gap:"4px",fontSize:"13px",color:"#6c757d"},toolbar:{display:"flex",gap:"12px",marginBottom:"20px",flexWrap:"wrap"},searchBox:{display:"flex",alignItems:"center",gap:"10px",padding:"10px 15px",background:"white",border:"1px solid #e9ecef",borderRadius:"10px",flex:1,maxWidth:"300px"},searchInput:{border:"none",outline:"none",fontSize:"14px",width:"100%",background:"transparent"},clearButton:{background:"none",border:"none",cursor:"pointer",color:"#999",padding:"2px"},select:{padding:"10px 15px",border:"1px solid #e9ecef",borderRadius:"10px",fontSize:"14px",background:"white",minWidth:"160px"},clearFiltersButton:{padding:"10px 16px",background:"#ffebee",color:"#c62828",border:"none",borderRadius:"10px",fontSize:"14px",cursor:"pointer"},tableContainer:{background:"white",borderRadius:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.05)",overflow:"auto"},table:{width:"100%",borderCollapse:"collapse",minWidth:"900px"},th:{padding:"15px 20px",textAlign:"left",background:"#f8f9fa",color:"#1a5d1a",fontWeight:"600",fontSize:"14px",borderBottom:"2px solid #e9ecef",whiteSpace:"nowrap"},tr:{borderBottom:"1px solid #e9ecef",transition:"background 0.2s"},td:{padding:"15px 20px",fontSize:"14px",color:"#495057"},code:{background:"#f8f9fa",padding:"4px 8px",borderRadius:"4px",fontFamily:"monospace",fontSize:"12px"},marca:{display:"block",fontSize:"12px",color:"#6c757d",marginTop:"2px"},badge:{display:"inline-flex",alignItems:"center",gap:"5px",padding:"6px 12px",borderRadius:"20px",fontSize:"12px",fontWeight:"600"},viewButton:{display:"flex",alignItems:"center",gap:"6px",padding:"8px 12px",background:"#e8f5e9",color:"#1a5d1a",border:"none",borderRadius:"8px",fontSize:"13px",fontWeight:"500",cursor:"pointer"},loadingState:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"60px 20px",color:"#6c757d",gap:"15px"},emptyState:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"60px 20px",color:"#6c757d",gap:"15px"},modalOverlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"20px"},modal:{background:"white",borderRadius:"16px",width:"100%",maxWidth:"700px",maxHeight:"90vh",overflow:"hidden",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.3)"},modalHeader:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",padding:"20px 25px",borderBottom:"1px solid #e9ecef",background:"linear-gradient(135deg, #f8f9fa, #e8f5e9)"},modalTitle:{margin:0,fontSize:"20px",fontWeight:"600",color:"#1a5d1a"},modalSubtitle:{margin:"5px 0 0 0",fontSize:"14px",color:"#6c757d"},closeButton:{background:"none",border:"none",cursor:"pointer",color:"#6c757d",padding:"5px"},modalBody:{padding:"25px",maxHeight:"calc(90vh - 100px)",overflowY:"auto"},productoInfo:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(140px, 1fr))",gap:"15px",marginBottom:"25px",padding:"15px",background:"#f8f9fa",borderRadius:"10px"},infoItem:{textAlign:"center"},infoLabel:{display:"block",fontSize:"12px",color:"#6c757d",marginBottom:"5px"},infoValue:{display:"block",fontSize:"16px",fontWeight:"600",color:"#1a5d1a"},emptyMovimientos:{textAlign:"center",padding:"30px",color:"#6c757d"},movimientosLista:{display:"flex",flexDirection:"column",gap:"10px"},movimientoItem:{display:"flex",alignItems:"center",gap:"15px",padding:"12px",background:"#f8f9fa",borderRadius:"10px"},movimientoIcono:{width:"40px",height:"40px",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},movimientoInfo:{flex:1},movimientoTipo:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"4px"},movimientoCantidad:{fontSize:"14px",fontWeight:"600"},movimientoMeta:{display:"flex",justifyContent:"space-between",fontSize:"12px",color:"#6c757d"}};export{ge as default};
