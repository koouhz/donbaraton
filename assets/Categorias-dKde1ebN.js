import{r as n,s as g,j as e,k as B,X as E}from"./index-DyRGlXyn.js";import{n as o,F as L,L as j}from"./index-Bk6qzOxF.js";import{P as _}from"./plus-CAyMjqEC.js";import{S as T}from"./search-BOAzkQOY.js";import{S as A}from"./square-pen-DfFVALX3.js";import{T as G}from"./trash-2-CTuwllM0.js";import{S as U}from"./save-C8gd7RBd.js";function $(){const[C,I]=n.useState([]),[m,S]=n.useState(!0),[f,p]=n.useState(!1),[l,z]=n.useState(""),[R,s]=n.useState(!1),[d,h]=n.useState(null),[i,x]=n.useState({nombre:"",descripcion:""}),b=()=>{const t=localStorage.getItem("user");if(t)try{return JSON.parse(t).usuario_id||"USR-001"}catch{return"USR-001"}return"USR-001"};n.useEffect(()=>{c()},[]);const c=async()=>{S(!0);try{const{data:t,error:a}=await g.rpc("fn_listar_categorias");a?(console.error("Error al cargar categorías:",a),o.error("Error al cargar categorías")):I(t||[])}catch(t){console.error("Error:",t),o.error("Error de conexión")}finally{S(!1)}},F=async()=>{if(!i.nombre.trim()){o.error("El nombre es obligatorio");return}p(!0);try{const{data:t,error:a}=await g.rpc("fn_crear_categoria",{p_nombre:i.nombre.trim(),p_descripcion:i.descripcion.trim()||null,p_usuario_auditoria:b()});a?(console.error("Error al crear:",a),o.error(a.message||"Error al crear categoría")):(o.success("Categoría creada exitosamente"),s(!1),y(),c())}catch(t){console.error("Error:",t),o.error("Error al crear categoría")}finally{p(!1)}},W=async()=>{if(!i.nombre.trim()){o.error("El nombre es obligatorio");return}p(!0);try{const{data:t,error:a}=await g.rpc("fn_editar_categoria",{p_id_categoria:d.id_categoria||d.id,p_nombre:i.nombre.trim(),p_descripcion:i.descripcion.trim()||null,p_usuario_auditoria:b()});a?(console.error("Error al actualizar:",a),o.error(a.message||"Error al actualizar categoría")):(o.success("Categoría actualizada exitosamente"),s(!1),y(),c())}catch(t){console.error("Error:",t),o.error("Error al actualizar categoría")}finally{p(!1)}},D=async(t,a)=>{if(window.confirm(`¿Estás seguro de eliminar la categoría "${a}"?`))try{const{data:k,error:u}=await g.rpc("fn_desactivar_categoria",{p_id_categoria:t,p_usuario_auditoria:b()});u?(console.error("Error al eliminar:",u),u.message.includes("productos asociados")?o.error("No se puede eliminar: tiene productos asociados"):o.error(u.message||"Error al eliminar categoría")):(o.success("Categoría eliminada exitosamente"),c())}catch(k){console.error("Error:",k),o.error("Error al eliminar categoría")}},N=t=>{h(t),x({nombre:t.nombre,descripcion:t.descripcion||""}),s(!0)},w=()=>{h(null),y(),s(!0)},y=()=>{x({nombre:"",descripcion:""}),h(null)},v=C.filter(t=>t.nombre.toLowerCase().includes(l.toLowerCase())||t.descripcion&&t.descripcion.toLowerCase().includes(l.toLowerCase()));return e.jsxs("div",{style:r.container,children:[e.jsx(L,{position:"top-right"}),e.jsxs("header",{style:r.header,children:[e.jsxs("div",{children:[e.jsxs("h1",{style:r.title,children:[e.jsx(B,{size:28,style:{marginRight:"12px"}}),"Categorías"]}),e.jsxs("p",{style:r.subtitle,children:["Gestión de categorías de productos • ",C.length," categorías"]})]}),e.jsxs("button",{style:r.primaryButton,onClick:w,children:[e.jsx(_,{size:18}),"Nueva Categoría"]})]}),e.jsxs("div",{style:r.toolbar,children:[e.jsxs("div",{style:r.searchBox,children:[e.jsx(T,{size:18,style:{color:"#6c757d"}}),e.jsx("input",{type:"text",placeholder:"Buscar categorías...",value:l,onChange:t=>z(t.target.value),style:r.searchInput}),l&&e.jsx("button",{onClick:()=>z(""),style:r.clearButton,children:e.jsx(E,{size:16})})]}),e.jsxs("button",{style:r.refreshButton,onClick:c,disabled:m,children:[e.jsx(j,{size:16,style:{animation:m?"spin 1s linear infinite":"none"}}),"Actualizar"]})]}),e.jsx("div",{style:r.tableContainer,children:m?e.jsxs("div",{style:r.loadingState,children:[e.jsx(j,{size:40,style:{animation:"spin 1s linear infinite",color:"#1a5d1a"}}),e.jsx("p",{children:"Cargando categorías..."})]}):v.length===0?e.jsxs("div",{style:r.emptyState,children:[e.jsx(B,{size:48,style:{color:"#ccc"}}),e.jsx("p",{children:l?"No se encontraron resultados":"No hay categorías registradas"}),!l&&e.jsxs("button",{style:r.primaryButton,onClick:w,children:[e.jsx(_,{size:18}),"Crear primera categoría"]})]}):e.jsxs("table",{style:r.table,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:r.th,children:"ID"}),e.jsx("th",{style:r.th,children:"Nombre"}),e.jsx("th",{style:r.th,children:"Descripción"}),e.jsx("th",{style:{...r.th,textAlign:"center"},children:"Acciones"})]})}),e.jsx("tbody",{children:v.map(t=>e.jsxs("tr",{style:r.tr,children:[e.jsx("td",{style:r.td,children:t.id_categoria}),e.jsx("td",{style:r.td,children:e.jsx("strong",{children:t.nombre})}),e.jsx("td",{style:r.td,children:t.descripcion||e.jsx("span",{style:{color:"#999"},children:"Sin descripción"})}),e.jsx("td",{style:{...r.td,textAlign:"center"},children:e.jsxs("div",{style:r.actionButtons,children:[e.jsx("button",{style:r.editButton,onClick:()=>N(t),title:"Editar",children:e.jsx(A,{size:16})}),e.jsx("button",{style:r.deleteButton,onClick:()=>D(t.id_categoria,t.nombre),title:"Eliminar",children:e.jsx(G,{size:16})})]})})]},t.id_categoria))})]})}),R&&e.jsx("div",{style:r.modalOverlay,onClick:()=>s(!1),children:e.jsxs("div",{style:r.modal,onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{style:r.modalHeader,children:[e.jsx("h2",{style:r.modalTitle,children:d?"Editar Categoría":"Nueva Categoría"}),e.jsx("button",{style:r.closeButton,onClick:()=>s(!1),children:e.jsx(E,{size:20})})]}),e.jsxs("div",{style:r.modalBody,children:[e.jsxs("div",{style:r.formGroup,children:[e.jsx("label",{style:r.label,children:"Nombre *"}),e.jsx("input",{type:"text",value:i.nombre,onChange:t=>x({...i,nombre:t.target.value}),style:r.input,placeholder:"Nombre de la categoría",autoFocus:!0})]}),e.jsxs("div",{style:r.formGroup,children:[e.jsx("label",{style:r.label,children:"Descripción"}),e.jsx("textarea",{value:i.descripcion,onChange:t=>x({...i,descripcion:t.target.value}),style:r.textarea,placeholder:"Descripción opcional",rows:3})]})]}),e.jsxs("div",{style:r.modalFooter,children:[e.jsx("button",{style:r.cancelButton,onClick:()=>s(!1),disabled:f,children:"Cancelar"}),e.jsx("button",{style:r.saveButton,onClick:d?W:F,disabled:f,children:f?e.jsxs(e.Fragment,{children:[e.jsx(j,{size:16,style:{animation:"spin 1s linear infinite"}}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{size:16}),d?"Actualizar":"Crear"]})})]})]})}),e.jsx("style",{children:`
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
      `})]})}const r={container:{padding:"20px",maxWidth:"1200px",margin:"0 auto"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"25px",flexWrap:"wrap",gap:"15px"},title:{margin:0,fontSize:"28px",fontWeight:"700",color:"#1a5d1a",display:"flex",alignItems:"center"},subtitle:{margin:"8px 0 0 0",color:"#6c757d",fontSize:"14px"},primaryButton:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 20px",background:"linear-gradient(135deg, #1a5d1a, #2e8b57)",color:"white",border:"none",borderRadius:"10px",fontSize:"14px",fontWeight:"600",cursor:"pointer",boxShadow:"0 4px 12px rgba(26, 93, 26, 0.3)",transition:"transform 0.2s, box-shadow 0.2s"},toolbar:{display:"flex",gap:"12px",marginBottom:"20px",flexWrap:"wrap"},searchBox:{display:"flex",alignItems:"center",gap:"10px",padding:"10px 15px",background:"white",border:"1px solid #e9ecef",borderRadius:"10px",flex:1,maxWidth:"400px"},searchInput:{border:"none",outline:"none",fontSize:"14px",width:"100%",background:"transparent"},clearButton:{background:"none",border:"none",cursor:"pointer",color:"#999",padding:"2px"},refreshButton:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 16px",background:"white",border:"1px solid #e9ecef",borderRadius:"10px",fontSize:"14px",color:"#495057",cursor:"pointer"},tableContainer:{background:"white",borderRadius:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.05)",overflow:"hidden"},table:{width:"100%",borderCollapse:"collapse"},th:{padding:"15px 20px",textAlign:"left",background:"#f8f9fa",color:"#1a5d1a",fontWeight:"600",fontSize:"14px",borderBottom:"2px solid #e9ecef"},tr:{borderBottom:"1px solid #e9ecef",transition:"background 0.2s"},td:{padding:"15px 20px",fontSize:"14px",color:"#495057"},actionButtons:{display:"flex",gap:"8px",justifyContent:"center"},editButton:{padding:"8px",background:"#e3f2fd",border:"none",borderRadius:"8px",cursor:"pointer",color:"#1976d2",transition:"background 0.2s"},deleteButton:{padding:"8px",background:"#ffebee",border:"none",borderRadius:"8px",cursor:"pointer",color:"#d32f2f",transition:"background 0.2s"},loadingState:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"60px 20px",color:"#6c757d",gap:"15px"},emptyState:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"60px 20px",color:"#6c757d",gap:"15px"},modalOverlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"20px"},modal:{background:"white",borderRadius:"16px",width:"100%",maxWidth:"500px",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.3)",overflow:"hidden"},modalHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 25px",borderBottom:"1px solid #e9ecef",background:"linear-gradient(135deg, #f8f9fa, #e8f5e9)"},modalTitle:{margin:0,fontSize:"20px",fontWeight:"600",color:"#1a5d1a"},closeButton:{background:"none",border:"none",cursor:"pointer",color:"#6c757d",padding:"5px",borderRadius:"5px"},modalBody:{padding:"25px"},formGroup:{marginBottom:"20px"},label:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500",color:"#1a5d1a"},input:{width:"100%",padding:"12px 15px",border:"2px solid #e9ecef",borderRadius:"10px",fontSize:"14px",transition:"border-color 0.2s",outline:"none",boxSizing:"border-box"},textarea:{width:"100%",padding:"12px 15px",border:"2px solid #e9ecef",borderRadius:"10px",fontSize:"14px",resize:"vertical",outline:"none",boxSizing:"border-box",fontFamily:"inherit"},modalFooter:{display:"flex",justifyContent:"flex-end",gap:"12px",padding:"20px 25px",borderTop:"1px solid #e9ecef",background:"#f8f9fa"},cancelButton:{padding:"10px 20px",background:"white",border:"1px solid #e9ecef",borderRadius:"8px",fontSize:"14px",cursor:"pointer",color:"#6c757d"},saveButton:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 20px",background:"linear-gradient(135deg, #1a5d1a, #2e8b57)",color:"white",border:"none",borderRadius:"8px",fontSize:"14px",fontWeight:"500",cursor:"pointer"}};export{$ as default};
