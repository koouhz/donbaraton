import{c as N,r as o,s as g,j as e,f as h,U as G,X as I,C as E}from"./index-DyRGlXyn.js";import{n as a,F as M,L as R}from"./index-Bk6qzOxF.js";import{R as O}from"./refresh-cw-VSjeutiz.js";import{P as y}from"./plus-CAyMjqEC.js";import{S as V}from"./search-BOAzkQOY.js";import{S as H}from"./save-C8gd7RBd.js";const P=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],$=N("circle-x",P);function Z(){const[m,W]=o.useState([]),[d,A]=o.useState([]),[f,b]=o.useState(!0),[j,C]=o.useState(!1),[c,v]=o.useState(""),[T,n]=o.useState(!1),[l,S]=o.useState({id_usuario:""}),z=()=>{const s=localStorage.getItem("user");if(s)try{return JSON.parse(s).username||"admin"}catch{return"admin"}return"admin"};o.useEffect(()=>{p()},[]);const p=async()=>{b(!0);try{const{data:s,error:t}=await g.rpc("fn_listar_cajeros");if(t)throw console.error("Error cajeros:",t),t;const x=(s||[]).filter(i=>i.estado==="ACTIVO"),{data:u,error:B}=await g.rpc("fn_listar_usuarios");B&&console.error("Error usuarios:",B);const U=x.map(i=>i.username),F=(u||[]).filter(i=>i.estado==="ACTIVO"&&!U.includes(i.username));W(x),A(F)}catch(s){console.error("Error:",s),a.error("Error al cargar datos")}finally{b(!1)}},D=async()=>{if(!l.id_usuario){a.error("Seleccione un usuario");return}C(!0);try{const{data:s,error:t}=await g.rpc("fn_crear_cajero",{p_id_usuario:l.id_usuario,p_usuario_auditoria:z()});t?t.message.includes("ya está registrado")?a.error("Este usuario ya es cajero"):a.error(t.message||"Error al crear cajero"):(a.success("Cajero registrado exitosamente"),n(!1),w(),p())}catch(s){console.error("Error:",s),a.error("Error al crear cajero")}finally{C(!1)}},L=async s=>{if(window.confirm(`¿Eliminar al cajero "${s.nombre_completo||s.username}"?

El cajero ya no podrá realizar operaciones de caja.`))try{const{error:t}=await g.rpc("fn_desactivar_cajero",{p_id_cajero:s.id_cajero,p_usuario_auditoria:z()});t?a.error(t.message||"Error al eliminar cajero"):(a.success("Cajero eliminado"),p())}catch(t){console.error("Error:",t),a.error("Error al eliminar cajero")}},k=()=>{w(),n(!0)},w=()=>{S({id_usuario:""})},_=m.filter(s=>{const t=(s.nombre_completo||"").toLowerCase(),x=(s.username||"").toLowerCase(),u=c.toLowerCase();return t.includes(u)||x.includes(u)});return e.jsxs("div",{style:r.container,children:[e.jsx(M,{position:"top-right"}),e.jsxs("header",{style:r.header,children:[e.jsxs("div",{children:[e.jsxs("h1",{style:r.title,children:[e.jsx(h,{size:28,style:{marginRight:"12px"}}),"Gestión de Cajeros"]}),e.jsxs("p",{style:r.subtitle,children:["Administración de cajeros del sistema • ",m.length," cajeros activos"]})]}),e.jsxs("div",{style:r.headerActions,children:[e.jsx("button",{style:r.refreshButton,onClick:p,disabled:f,children:e.jsx(O,{size:18,style:{animation:f?"spin 1s linear infinite":"none"}})}),e.jsxs("button",{style:r.primaryButton,onClick:k,children:[e.jsx(y,{size:18}),"Nuevo Cajero"]})]})]}),e.jsxs("div",{style:r.statsGrid,children:[e.jsxs("div",{style:r.statCard,children:[e.jsx(G,{size:28,style:{color:"#1a5d1a"}}),e.jsxs("div",{children:[e.jsx("span",{style:r.statValue,children:m.length}),e.jsx("span",{style:r.statLabel,children:"Total Cajeros"})]})]}),e.jsxs("div",{style:r.statCard,children:[e.jsx(h,{size:28,style:{color:"#1565c0"}}),e.jsxs("div",{children:[e.jsx("span",{style:{...r.statValue,color:"#1565c0"},children:d.length}),e.jsx("span",{style:r.statLabel,children:"Usuarios Disponibles"})]})]})]}),e.jsx("div",{style:r.toolbar,children:e.jsxs("div",{style:r.searchBox,children:[e.jsx(V,{size:18,style:{color:"#6c757d"}}),e.jsx("input",{type:"text",placeholder:"Buscar cajero...",value:c,onChange:s=>v(s.target.value),style:r.searchInput}),c&&e.jsx("button",{onClick:()=>v(""),style:r.clearButton,children:e.jsx(I,{size:16})})]})}),e.jsxs("div",{style:r.infoCard,children:[e.jsx(E,{size:18}),e.jsx("p",{children:"Los cajeros son usuarios habilitados para realizar operaciones de caja y ventas."})]}),e.jsx("div",{style:r.tableContainer,children:f?e.jsxs("div",{style:r.loadingState,children:[e.jsx(R,{size:40,style:{animation:"spin 1s linear infinite",color:"#1a5d1a"}}),e.jsx("p",{children:"Cargando cajeros..."})]}):_.length===0?e.jsxs("div",{style:r.emptyState,children:[e.jsx(h,{size:48,style:{color:"#ccc"}}),e.jsx("p",{children:c?"No se encontraron cajeros":"No hay cajeros registrados"}),e.jsxs("button",{style:r.primaryButton,onClick:k,children:[e.jsx(y,{size:18})," Agregar primer cajero"]})]}):e.jsxs("table",{style:r.table,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:r.th,children:"ID Cajero"}),e.jsx("th",{style:r.th,children:"Nombre"}),e.jsx("th",{style:r.th,children:"Usuario"}),e.jsx("th",{style:{...r.th,textAlign:"center"},children:"Acciones"})]})}),e.jsx("tbody",{children:_.map(s=>e.jsxs("tr",{style:r.tr,children:[e.jsx("td",{style:r.td,children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("div",{style:r.avatar,children:e.jsx(h,{size:18})}),e.jsx("span",{style:{fontWeight:"500",color:"#1a5d1a"},children:s.id_cajero})]})}),e.jsx("td",{style:r.td,children:e.jsx("strong",{children:s.nombre_completo||"-"})}),e.jsx("td",{style:r.td,children:e.jsxs("span",{style:r.usernameBadge,children:["@",s.username||"-"]})}),e.jsx("td",{style:{...r.td,textAlign:"center"},children:e.jsxs("button",{style:r.deleteButton,onClick:()=>L(s),title:"Eliminar cajero",children:[e.jsx($,{size:16})," Eliminar"]})})]},s.id_cajero))})]})}),T&&e.jsx("div",{style:r.modalOverlay,onClick:()=>n(!1),children:e.jsxs("div",{style:r.modal,onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{style:r.modalHeader,children:[e.jsxs("h2",{style:r.modalTitle,children:[e.jsx(y,{size:20,style:{marginRight:"10px"}}),"Nuevo Cajero"]}),e.jsx("button",{style:r.closeButton,onClick:()=>n(!1),children:e.jsx(I,{size:20})})]}),e.jsx("div",{style:r.modalBody,children:d.length===0?e.jsxs("div",{style:r.noUsersMessage,children:[e.jsx(E,{size:40,style:{color:"#f57c00",marginBottom:"15px"}}),e.jsx("p",{style:{margin:0,fontWeight:"600",color:"#333"},children:"No hay usuarios disponibles"}),e.jsx("p",{style:{margin:"10px 0 0 0",fontSize:"14px",color:"#6c757d"},children:"Todos los usuarios activos ya están registrados como cajeros."})]}):e.jsxs("div",{style:r.formGroup,children:[e.jsx("label",{style:r.label,children:"Seleccionar Usuario *"}),e.jsxs("select",{value:l.id_usuario,onChange:s=>S({...l,id_usuario:s.target.value}),style:r.input,children:[e.jsx("option",{value:"",children:"-- Seleccione un usuario --"}),d.map(s=>e.jsx("option",{value:s.id_usuario,children:s.empleado_nombre?`${s.empleado_nombre} (@${s.username})`:s.username},s.id_usuario))]}),e.jsx("p",{style:r.helpText,children:"El usuario seleccionado será habilitado para realizar operaciones de caja."})]})}),e.jsxs("div",{style:r.modalFooter,children:[e.jsx("button",{style:r.cancelButton,onClick:()=>n(!1),disabled:j,children:"Cancelar"}),d.length>0&&e.jsx("button",{style:r.saveButton,onClick:D,disabled:j||!l.id_usuario,children:j?e.jsxs(e.Fragment,{children:[e.jsx(R,{size:16,style:{animation:"spin 1s linear infinite"}})," Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{size:16})," Registrar Cajero"]})})]})]})}),e.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]})}const r={container:{padding:"20px",maxWidth:"1200px",margin:"0 auto"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"25px",flexWrap:"wrap",gap:"15px"},title:{margin:0,fontSize:"28px",fontWeight:"700",color:"#1a5d1a",display:"flex",alignItems:"center"},subtitle:{margin:"8px 0 0 0",color:"#6c757d",fontSize:"14px"},headerActions:{display:"flex",gap:"12px",alignItems:"center"},refreshButton:{padding:"10px",background:"white",border:"1px solid #e9ecef",borderRadius:"10px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},primaryButton:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 20px",background:"linear-gradient(135deg, #1a5d1a, #2e8b57)",color:"white",border:"none",borderRadius:"10px",fontSize:"14px",fontWeight:"600",cursor:"pointer"},statsGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"15px",marginBottom:"20px"},statCard:{display:"flex",alignItems:"center",gap:"15px",padding:"20px",background:"white",borderRadius:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.05)"},statValue:{display:"block",fontSize:"28px",fontWeight:"700",color:"#1a5d1a"},statLabel:{fontSize:"13px",color:"#6c757d"},toolbar:{marginBottom:"15px"},searchBox:{display:"flex",alignItems:"center",gap:"10px",padding:"10px 15px",background:"white",border:"1px solid #e9ecef",borderRadius:"10px",flex:1,maxWidth:"350px"},searchInput:{border:"none",outline:"none",fontSize:"14px",width:"100%",background:"transparent"},clearButton:{background:"none",border:"none",cursor:"pointer",color:"#999",padding:"2px"},infoCard:{display:"flex",alignItems:"center",gap:"12px",padding:"15px 20px",background:"#fff3e0",borderRadius:"10px",marginBottom:"20px",color:"#e65100",fontSize:"14px"},tableContainer:{background:"white",borderRadius:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.05)",overflow:"auto"},table:{width:"100%",borderCollapse:"collapse",minWidth:"600px"},th:{padding:"15px 20px",textAlign:"left",background:"#f8f9fa",color:"#1a5d1a",fontWeight:"600",fontSize:"14px",borderBottom:"2px solid #e9ecef"},tr:{borderBottom:"1px solid #e9ecef"},td:{padding:"15px 20px",fontSize:"14px",color:"#495057"},avatar:{width:"40px",height:"40px",borderRadius:"50%",background:"linear-gradient(135deg, #1a5d1a, #2e8b57)",display:"flex",alignItems:"center",justifyContent:"center",color:"white"},usernameBadge:{padding:"4px 10px",background:"#e8f5e9",borderRadius:"6px",color:"#1a5d1a",fontSize:"13px",fontWeight:"500"},deleteButton:{display:"flex",alignItems:"center",gap:"6px",padding:"8px 14px",background:"#ffebee",border:"none",borderRadius:"8px",cursor:"pointer",color:"#d32f2f",fontSize:"13px",fontWeight:"500"},loadingState:{display:"flex",flexDirection:"column",alignItems:"center",padding:"60px",color:"#6c757d",gap:"15px"},emptyState:{display:"flex",flexDirection:"column",alignItems:"center",padding:"60px",color:"#6c757d",gap:"15px"},modalOverlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"20px"},modal:{background:"white",borderRadius:"16px",width:"100%",maxWidth:"500px",maxHeight:"90vh",overflow:"hidden",display:"flex",flexDirection:"column"},modalHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 25px",borderBottom:"1px solid #e9ecef",background:"linear-gradient(135deg, #f8f9fa, #e8f5e9)"},modalTitle:{margin:0,fontSize:"20px",fontWeight:"600",color:"#1a5d1a",display:"flex",alignItems:"center"},closeButton:{background:"none",border:"none",cursor:"pointer",color:"#6c757d"},modalBody:{padding:"25px",overflowY:"auto",flex:1},formGroup:{marginBottom:"20px"},label:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500",color:"#1a5d1a"},input:{width:"100%",padding:"12px 15px",border:"2px solid #e9ecef",borderRadius:"10px",fontSize:"14px",boxSizing:"border-box"},helpText:{marginTop:"8px",fontSize:"12px",color:"#6c757d"},noUsersMessage:{textAlign:"center",padding:"30px 20px"},modalFooter:{display:"flex",justifyContent:"flex-end",gap:"12px",padding:"20px 25px",borderTop:"1px solid #e9ecef",background:"#f8f9fa"},cancelButton:{padding:"10px 20px",background:"white",border:"1px solid #e9ecef",borderRadius:"8px",fontSize:"14px",cursor:"pointer",color:"#6c757d"},saveButton:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 20px",background:"linear-gradient(135deg, #1a5d1a, #2e8b57)",color:"white",border:"none",borderRadius:"8px",fontSize:"14px",fontWeight:"500",cursor:"pointer"}};export{Z as default};
