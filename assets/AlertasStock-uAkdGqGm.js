import{u as S,r as l,s as g,j as e,l as m,P as v,C as _,b as C}from"./index-DyRGlXyn.js";import{n as z,F as w,L}from"./index-Bk6qzOxF.js";import{T as i}from"./triangle-alert-DqqKGNFw.js";import{R}from"./refresh-cw-VSjeutiz.js";import{C as p}from"./clock-B6XNtadS.js";function V(){const u=S(),[n,j]=l.useState([]),[c,b]=l.useState([]),[d,h]=l.useState(!0),[x,f]=l.useState("stock");l.useEffect(()=>{y()},[]);const y=async()=>{h(!0);try{const[s,r]=await Promise.all([g.rpc("fn_generar_alertas_stock_bajo"),g.rpc("fn_alerta_vencimientos",{p_dias_anticipacion:30})]);if(s.error)console.error("Error stock:",s.error);else{const o=(s.data||[]).map(a=>({id_producto:a.id_producto,codigo_interno:a.id_producto,nombre:a.nombre,marca:null,stock_actual:a.stock_actual,stock_minimo:a.stock_minimo,precio_venta:0,unidad_medida:"UNIDAD",categoria:a.proveedor||"Sin categoría",faltante:a.faltante,porcentaje_stock:a.stock_minimo>0?Math.round(a.stock_actual/a.stock_minimo*100):0}));j(o)}r.error?console.error("Error vencimientos:",r.error):b(r.data||[])}catch(s){console.error("Error:",s),z.error("Error al cargar alertas")}finally{h(!1)}},k=s=>{const r={ROJO:{bg:"#ffebee",color:"#c62828",border:"#ef9a9a"},AMARILLO:{bg:"#fff8e1",color:"#f57f17",border:"#ffe082"},VERDE:{bg:"#e8f5e9",color:"#2e7d32",border:"#a5d6a7"}};return r[s]||r.VERDE};return e.jsxs("div",{style:t.container,children:[e.jsx(w,{position:"top-right"}),e.jsxs("header",{style:t.header,children:[e.jsxs("div",{children:[e.jsxs("h1",{style:t.title,children:[e.jsx(i,{size:28,style:{marginRight:"12px",color:"#e65100"}}),"Alertas de Stock"]}),e.jsx("p",{style:t.subtitle,children:"Monitoreo de productos con stock bajo y próximos a vencer"})]}),e.jsxs("button",{style:t.refreshButton,onClick:y,disabled:d,children:[e.jsx(R,{size:18,style:{animation:d?"spin 1s linear infinite":"none"}}),"Actualizar"]})]}),e.jsxs("div",{style:t.summaryCards,children:[e.jsxs("div",{style:{...t.summaryCard,borderLeft:"4px solid #c62828",background:x==="stock"?"#fff5f5":"white",cursor:"pointer"},onClick:()=>f("stock"),children:[e.jsx(i,{size:32,style:{color:"#c62828"}}),e.jsxs("div",{children:[e.jsx("span",{style:{...t.summaryValue,color:"#c62828"},children:n.length}),e.jsx("span",{style:t.summaryLabel,children:"Productos con Stock Bajo"})]}),e.jsx(m,{size:20,style:{color:"#ccc"}})]}),e.jsxs("div",{style:{...t.summaryCard,borderLeft:"4px solid #e65100",background:x==="vencimiento"?"#fff8e1":"white",cursor:"pointer"},onClick:()=>f("vencimiento"),children:[e.jsx(p,{size:32,style:{color:"#e65100"}}),e.jsxs("div",{children:[e.jsx("span",{style:{...t.summaryValue,color:"#e65100"},children:c.length}),e.jsx("span",{style:t.summaryLabel,children:"Próximos a Vencer (30 días)"})]}),e.jsx(m,{size:20,style:{color:"#ccc"}})]})]}),d?e.jsxs("div",{style:t.loadingState,children:[e.jsx(L,{size:40,style:{animation:"spin 1s linear infinite",color:"#1a5d1a"}}),e.jsx("p",{children:"Cargando alertas..."})]}):x==="stock"?e.jsxs("div",{style:t.section,children:[e.jsxs("h2",{style:t.sectionTitle,children:[e.jsx(i,{size:20,style:{color:"#c62828"}}),"Productos con Stock Bajo o Agotado"]}),n.length===0?e.jsxs("div",{style:t.emptyState,children:[e.jsx(v,{size:48,style:{color:"#2e7d32"}}),e.jsx("p",{style:{color:"#2e7d32"},children:"¡Excelente! No hay productos con stock bajo"})]}):e.jsx("div",{style:t.alertsList,children:n.map((s,r)=>e.jsxs("div",{style:{...t.alertCard,background:s.stock_actual<=0?"#fff5f5":"#fffbf0",borderLeft:`4px solid ${s.stock_actual<=0?"#c62828":"#e65100"}`},children:[e.jsx("div",{style:{...t.alertIcon,background:s.stock_actual<=0?"#ffcdd2":"#ffe0b2"},children:s.stock_actual<=0?e.jsx(i,{size:24,style:{color:"#c62828"}}):e.jsx(_,{size:24,style:{color:"#e65100"}})}),e.jsxs("div",{style:t.alertContent,children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"4px"},children:[e.jsx("code",{style:{background:"#e9ecef",padding:"2px 8px",borderRadius:"4px",fontSize:"11px",color:"#495057"},children:s.codigo_interno}),e.jsx("span",{style:{padding:"2px 8px",borderRadius:"10px",fontSize:"10px",fontWeight:"600",background:s.stock_actual<=0?"#c62828":"#e65100",color:"white"},children:s.stock_actual<=0?"AGOTADO":"BAJO STOCK"})]}),e.jsx("h3",{style:t.alertTitle,children:s.nombre}),e.jsxs("div",{style:{display:"flex",gap:"15px",flexWrap:"wrap",marginTop:"8px"},children:[s.marca&&e.jsxs("span",{style:t.productDetail,children:[e.jsx("strong",{children:"Marca:"})," ",s.marca]}),e.jsxs("span",{style:t.productDetail,children:[e.jsx("strong",{children:"Categoría:"})," ",s.categoria]}),e.jsxs("span",{style:t.productDetail,children:[e.jsx("strong",{children:"Unidad:"})," ",s.unidad_medida||"UNIDAD"]}),e.jsxs("span",{style:t.productDetail,children:[e.jsx("strong",{children:"Precio:"})," Bs ",parseFloat(s.precio_venta||0).toFixed(2)]})]})]}),e.jsxs("div",{style:t.alertStats,children:[e.jsxs("div",{style:t.alertStat,children:[e.jsx("span",{style:t.alertStatLabel,children:"Stock Actual"}),e.jsx("span",{style:{...t.alertStatValue,color:s.stock_actual<=0?"#c62828":"#e65100"},children:s.stock_actual})]}),e.jsxs("div",{style:t.alertStat,children:[e.jsx("span",{style:t.alertStatLabel,children:"Mínimo"}),e.jsx("span",{style:t.alertStatValue,children:s.stock_minimo})]}),e.jsxs("div",{style:t.alertStat,children:[e.jsx("span",{style:t.alertStatLabel,children:"Faltante"}),e.jsxs("span",{style:{...t.alertStatValue,color:"#c62828"},children:["-",s.faltante]})]}),e.jsxs("div",{style:t.alertStat,children:[e.jsx("span",{style:t.alertStatLabel,children:"Estado"}),e.jsx("div",{style:{width:"60px",height:"8px",background:"#e9ecef",borderRadius:"4px",overflow:"hidden",marginTop:"4px"},children:e.jsx("div",{style:{width:`${Math.min(s.porcentaje_stock,100)}%`,height:"100%",background:s.stock_actual<=0?"#c62828":"#e65100",borderRadius:"4px"}})}),e.jsxs("span",{style:{fontSize:"10px",color:"#6c757d"},children:[s.porcentaje_stock,"%"]})]})]}),e.jsx("button",{style:t.orderButton,onClick:()=>u("/compras"),children:"Crear Orden"})]},s.id_producto||r))})]}):e.jsxs("div",{style:t.section,children:[e.jsxs("h2",{style:t.sectionTitle,children:[e.jsx(p,{size:20,style:{color:"#e65100"}}),"Productos Próximos a Vencer"]}),c.length===0?e.jsxs("div",{style:t.emptyState,children:[e.jsx(C,{size:48,style:{color:"#2e7d32"}}),e.jsx("p",{style:{color:"#2e7d32"},children:"No hay productos próximos a vencer"})]}):e.jsx("div",{style:t.alertsList,children:c.map((s,r)=>{const o=k(s.estado_alerta);return e.jsxs("div",{style:{...t.alertCard,background:o.bg,borderColor:o.border},children:[e.jsx("div",{style:{...t.alertIcon,background:o.color},children:e.jsx(p,{size:24,style:{color:"white"}})}),e.jsxs("div",{style:t.alertContent,children:[e.jsx("h3",{style:t.alertTitle,children:s.producto}),e.jsxs("p",{style:t.alertProveedor,children:["Lote: ",s.lote||"Sin lote"]})]}),e.jsxs("div",{style:t.alertStats,children:[e.jsxs("div",{style:t.alertStat,children:[e.jsx("span",{style:t.alertStatLabel,children:"Vence"}),e.jsx("span",{style:t.alertStatValue,children:new Date(s.fecha_vencimiento).toLocaleDateString("es-BO")})]}),e.jsxs("div",{style:t.alertStat,children:[e.jsx("span",{style:t.alertStatLabel,children:"Días"}),e.jsx("span",{style:{...t.alertStatValue,color:o.color},children:s.dias_restantes})]})]}),e.jsx("div",{style:{...t.semaforoBadge,background:o.color},children:s.estado_alerta})]},r)})})]}),e.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]})}const t={container:{padding:"20px",maxWidth:"1200px",margin:"0 auto"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"25px",flexWrap:"wrap",gap:"15px"},title:{margin:0,fontSize:"28px",fontWeight:"700",color:"#1a5d1a",display:"flex",alignItems:"center"},subtitle:{margin:"8px 0 0 0",color:"#6c757d",fontSize:"14px"},refreshButton:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 16px",background:"white",border:"1px solid #e9ecef",borderRadius:"10px",fontSize:"14px",cursor:"pointer",color:"#495057"},summaryCards:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"20px",marginBottom:"30px"},summaryCard:{display:"flex",alignItems:"center",gap:"20px",padding:"25px",background:"white",borderRadius:"16px",boxShadow:"0 2px 12px rgba(0,0,0,0.08)",transition:"transform 0.2s, box-shadow 0.2s"},summaryValue:{fontSize:"36px",fontWeight:"700",display:"block"},summaryLabel:{fontSize:"14px",color:"#6c757d"},section:{background:"white",borderRadius:"16px",padding:"25px",boxShadow:"0 2px 12px rgba(0,0,0,0.05)"},sectionTitle:{display:"flex",alignItems:"center",gap:"10px",margin:"0 0 20px 0",fontSize:"18px",fontWeight:"600",color:"#333"},alertsList:{display:"flex",flexDirection:"column",gap:"15px"},alertCard:{display:"flex",alignItems:"center",gap:"20px",padding:"20px",background:"#fafafa",borderRadius:"12px",border:"1px solid #e9ecef",flexWrap:"wrap"},alertIcon:{width:"50px",height:"50px",borderRadius:"12px",background:"#ffebee",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},alertContent:{flex:1,minWidth:"200px"},alertTitle:{margin:0,fontSize:"16px",fontWeight:"600",color:"#333"},alertProveedor:{margin:"5px 0 0 0",fontSize:"13px",color:"#6c757d"},alertStats:{display:"flex",gap:"25px"},alertStat:{textAlign:"center"},alertStatLabel:{display:"block",fontSize:"11px",color:"#6c757d",textTransform:"uppercase",marginBottom:"4px"},alertStatValue:{fontSize:"20px",fontWeight:"700",color:"#333"},orderButton:{padding:"10px 20px",background:"linear-gradient(135deg, #1a5d1a, #2e8b57)",color:"white",border:"none",borderRadius:"8px",fontSize:"14px",fontWeight:"500",cursor:"pointer"},semaforoBadge:{padding:"8px 16px",borderRadius:"20px",color:"white",fontSize:"12px",fontWeight:"600",textTransform:"uppercase"},loadingState:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"80px 20px",color:"#6c757d",gap:"15px",background:"white",borderRadius:"16px"},emptyState:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"60px 20px",color:"#6c757d",gap:"15px"},productDetail:{fontSize:"12px",color:"#666",display:"inline-block"}};export{V as default};
