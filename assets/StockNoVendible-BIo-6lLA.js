import{r as n,s as y,j as e,X as R,P as w,i as j,b as A}from"./index-DyRGlXyn.js";import{n as x,F as B,L as I}from"./index-Bk6qzOxF.js";import{T as b}from"./triangle-alert-DqqKGNFw.js";import{R as _}from"./refresh-cw-VSjeutiz.js";import{S as L}from"./search-BOAzkQOY.js";import{F as T}from"./file-text-CuqINRXR.js";import{T as m}from"./trash-2-CTuwllM0.js";import{C as N}from"./clock-B6XNtadS.js";function G(){const[a,v]=n.useState([]),[C,h]=n.useState(!0),[d,k]=n.useState(""),[c,S]=n.useState(""),[i,u]=n.useState("");n.useEffect(()=>{p()},[d,c]);const p=async()=>{h(!0);try{const{data:o,error:s}=await y.rpc("fn_leer_stock_no_vendible",{p_estado:d||null,p_motivo:c||null});if(s)throw s;v(o||[])}catch(o){console.error("Error al cargar stock no vendible:",o),x.error("Error al cargar datos")}finally{h(!1)}},f=async(o,s)=>{try{const{error:r}=await y.rpc("fn_actualizar_stock_no_vendible",{p_id_registro:o,p_nuevo_estado:s,p_username:localStorage.getItem("username")||"admin"});if(r)throw r;x.success(`Estado actualizado a: ${s}`),p()}catch(r){console.error("Error al actualizar estado:",r),x.error("Error al actualizar estado")}},E=o=>o==="DAÑADO"?{background:"#ffebee",color:"#c62828",icon:e.jsx(b,{size:14})}:{background:"#fff3e0",color:"#ef6c00",icon:e.jsx(A,{size:14})},z=o=>{switch(o){case"PENDIENTE":return{background:"#fff8e1",color:"#f57f17",icon:e.jsx(N,{size:14})};case"DESCARTADO":return{background:"#ffebee",color:"#c62828",icon:e.jsx(m,{size:14})};case"RECUPERADO":return{background:"#e8f5e9",color:"#2e7d32",icon:e.jsx(j,{size:14})};default:return{background:"#f5f5f5",color:"#666"}}},D=o=>new Date(o).toLocaleDateString("es-BO",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),g=a.filter(o=>!i||o.producto?.toLowerCase().includes(i.toLowerCase())||o.codigo_interno?.toLowerCase().includes(i.toLowerCase())),l={total:a.length,danados:a.filter(o=>o.motivo==="DAÑADO").length,vencidos:a.filter(o=>o.motivo==="VENCIDO").length,pendientes:a.filter(o=>o.estado==="PENDIENTE").length};return e.jsxs("div",{style:t.container,children:[e.jsx(B,{position:"top-right"}),e.jsxs("div",{style:t.header,children:[e.jsxs("h2",{style:t.title,children:[e.jsx(b,{size:28,color:"#ef6c00"}),"Stock No Vendible"]}),e.jsxs("button",{style:t.refreshButton,onClick:p,children:[e.jsx(_,{size:18}),"Actualizar"]})]}),e.jsxs("div",{style:t.statsGrid,children:[e.jsxs("div",{style:{...t.statCard,borderLeft:"4px solid #ef6c00"},children:[e.jsx("span",{style:t.statValue,children:l.total}),e.jsx("span",{style:t.statLabel,children:"Total Registros"})]}),e.jsxs("div",{style:{...t.statCard,borderLeft:"4px solid #c62828"},children:[e.jsx("span",{style:t.statValue,children:l.danados}),e.jsx("span",{style:t.statLabel,children:"Dañados"})]}),e.jsxs("div",{style:{...t.statCard,borderLeft:"4px solid #f57f17"},children:[e.jsx("span",{style:t.statValue,children:l.vencidos}),e.jsx("span",{style:t.statLabel,children:"Vencidos"})]}),e.jsxs("div",{style:{...t.statCard,borderLeft:"4px solid #1976d2"},children:[e.jsx("span",{style:t.statValue,children:l.pendientes}),e.jsx("span",{style:t.statLabel,children:"Pendientes"})]})]}),e.jsxs("div",{style:t.filtersSection,children:[e.jsxs("div",{style:t.searchBox,children:[e.jsx(L,{size:18,color:"#999"}),e.jsx("input",{type:"text",placeholder:"Buscar producto...",value:i,onChange:o=>u(o.target.value),style:t.searchInput}),i&&e.jsx("button",{style:t.clearButton,onClick:()=>u(""),children:e.jsx(R,{size:16})})]}),e.jsxs("select",{style:t.select,value:c,onChange:o=>S(o.target.value),children:[e.jsx("option",{value:"",children:"Todos los motivos"}),e.jsx("option",{value:"DAÑADO",children:"Dañados"}),e.jsx("option",{value:"VENCIDO",children:"Vencidos"})]}),e.jsxs("select",{style:t.select,value:d,onChange:o=>k(o.target.value),children:[e.jsx("option",{value:"",children:"Todos los estados"}),e.jsx("option",{value:"PENDIENTE",children:"Pendientes"}),e.jsx("option",{value:"DESCARTADO",children:"Descartados"}),e.jsx("option",{value:"RECUPERADO",children:"Recuperados"})]})]}),C?e.jsxs("div",{style:t.loadingState,children:[e.jsx(I,{size:40,style:{animation:"spin 1s linear infinite"}}),e.jsx("span",{children:"Cargando stock no vendible..."})]}):g.length===0?e.jsxs("div",{style:t.emptyState,children:[e.jsx(w,{size:60,color:"#ccc"}),e.jsx("h3",{children:"No hay registros"}),e.jsx("p",{children:"No se encontraron productos en stock no vendible"})]}):e.jsx("div",{style:t.tableContainer,children:e.jsxs("table",{style:t.table,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:t.th,children:"Producto"}),e.jsx("th",{style:t.th,children:"Código"}),e.jsx("th",{style:t.th,children:"Cantidad"}),e.jsx("th",{style:t.th,children:"Motivo"}),e.jsx("th",{style:t.th,children:"Estado"}),e.jsx("th",{style:t.th,children:"Fecha"}),e.jsx("th",{style:t.th,children:"Devolución"}),e.jsx("th",{style:t.th,children:"Acciones"})]})}),e.jsx("tbody",{children:g.map(o=>{const s=E(o.motivo),r=z(o.estado);return e.jsxs("tr",{style:t.tr,children:[e.jsx("td",{style:t.td,children:e.jsx("strong",{children:o.producto})}),e.jsx("td",{style:t.td,children:e.jsx("span",{style:t.codigo,children:o.codigo_interno})}),e.jsx("td",{style:t.td,children:e.jsx("span",{style:t.cantidad,children:o.cantidad})}),e.jsx("td",{style:t.td,children:e.jsxs("span",{style:{...t.badge,background:s.background,color:s.color},children:[s.icon,o.motivo]})}),e.jsx("td",{style:t.td,children:e.jsxs("span",{style:{...t.badge,background:r.background,color:r.color},children:[r.icon,o.estado]})}),e.jsx("td",{style:t.td,children:e.jsx("small",{children:D(o.fecha)})}),e.jsx("td",{style:t.td,children:e.jsxs("span",{style:t.devolucionRef,children:[e.jsx(T,{size:14}),o.devolucion_origen||"-"]})}),e.jsx("td",{style:t.td,children:o.estado==="PENDIENTE"&&e.jsxs("div",{style:t.actionButtons,children:[e.jsx("button",{style:t.btnDescartar,onClick:()=>f(o.id,"DESCARTADO"),title:"Marcar como descartado",children:e.jsx(m,{size:14})}),e.jsx("button",{style:t.btnRecuperar,onClick:()=>f(o.id,"RECUPERADO"),title:"Marcar como recuperado",children:e.jsx(j,{size:14})})]})})]},o.id)})})]})}),e.jsx("style",{children:`
                @keyframes spin {
                    from { transform: rotate(0deg); }
                    to { transform: rotate(360deg); }
                }
            `})]})}const t={container:{padding:"20px",maxWidth:"1400px",margin:"0 auto"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px",flexWrap:"wrap",gap:"15px"},title:{display:"flex",alignItems:"center",gap:"12px",fontSize:"24px",fontWeight:"700",color:"#333",margin:0},refreshButton:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 16px",background:"#f5f5f5",color:"#333",border:"none",borderRadius:"10px",fontSize:"14px",fontWeight:"500",cursor:"pointer"},statsGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(160px, 1fr))",gap:"15px",marginBottom:"20px"},statCard:{background:"white",borderRadius:"12px",padding:"20px",boxShadow:"0 2px 8px rgba(0,0,0,0.05)"},statValue:{fontSize:"28px",fontWeight:"700",color:"#333",display:"block"},statLabel:{fontSize:"13px",color:"#6c757d",marginTop:"5px",display:"block"},filtersSection:{display:"flex",gap:"12px",marginBottom:"20px",flexWrap:"wrap"},searchBox:{display:"flex",alignItems:"center",gap:"10px",padding:"10px 15px",background:"white",borderRadius:"10px",border:"1px solid #e9ecef",flex:"1",minWidth:"250px"},searchInput:{border:"none",outline:"none",fontSize:"14px",flex:1},clearButton:{background:"none",border:"none",cursor:"pointer",color:"#999",padding:"2px"},select:{padding:"10px 15px",border:"1px solid #e9ecef",borderRadius:"10px",fontSize:"14px",background:"white",minWidth:"160px"},tableContainer:{background:"white",borderRadius:"12px",overflow:"hidden",boxShadow:"0 2px 8px rgba(0,0,0,0.05)"},table:{width:"100%",borderCollapse:"collapse"},th:{padding:"14px 16px",textAlign:"left",background:"#f8f9fa",color:"#495057",fontWeight:"600",fontSize:"13px",borderBottom:"2px solid #e9ecef"},tr:{borderBottom:"1px solid #f0f0f0",transition:"background 0.2s"},td:{padding:"14px 16px",fontSize:"14px",color:"#333"},badge:{display:"inline-flex",alignItems:"center",gap:"5px",padding:"5px 10px",borderRadius:"6px",fontSize:"12px",fontWeight:"600"},codigo:{fontFamily:"monospace",background:"#f5f5f5",padding:"3px 8px",borderRadius:"4px",fontSize:"12px"},cantidad:{fontWeight:"700",fontSize:"16px",color:"#ef6c00"},devolucionRef:{display:"flex",alignItems:"center",gap:"5px",color:"#666",fontSize:"12px"},actionButtons:{display:"flex",gap:"8px"},btnDescartar:{display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",background:"#ffebee",color:"#c62828",border:"none",borderRadius:"8px",cursor:"pointer"},btnRecuperar:{display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",background:"#e8f5e9",color:"#2e7d32",border:"none",borderRadius:"8px",cursor:"pointer"},loadingState:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"60px 20px",color:"#6c757d",gap:"15px"},emptyState:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"60px 20px",background:"white",borderRadius:"12px",color:"#6c757d",textAlign:"center"}};export{G as default};
