import{r as s,s as c,j as e,p as h,b as _,X as N,P as S}from"./index-hR7h3xft.js";import{n,F as W,L as z}from"./index-BTmhdvE4.js";import{P as A}from"./plus-5-QD-99n.js";import{T as m}from"./triangle-alert-B_IWcPwx.js";import{S as F}from"./search-BOrDwhaZ.js";import{S as G}from"./save-CVL2Myj-.js";import{F as L}from"./file-text-yG9jYhSI.js";function Y(){const[p,C]=s.useState([]),[R,D]=s.useState([]),[b,x]=s.useState([]),[w,v]=s.useState(!0),[u,y]=s.useState(!1),[O,l]=s.useState(!1),[r,d]=s.useState({id_recepcion:"",id_producto:"",motivo:"",cantidad:"",observaciones:""}),I=()=>{try{const o=localStorage.getItem("userData");if(o)return JSON.parse(o).username||"admin"}catch{}return"admin"};s.useEffect(()=>{j()},[]);const j=async()=>{v(!0);try{const o=await c.rpc("fn_leer_devoluciones_proveedor");o.error||C(o.data||[]);const i=await c.rpc("fn_leer_recepciones_para_devolucion");i.error||D(i.data||[])}catch(o){console.error("Error:",o),n.error("Error de conexión")}finally{v(!1)}},k=async o=>{if(!o){x([]);return}const{data:i,error:a}=await c.rpc("fn_leer_detalle_recepcion",{p_id_recepcion:o});a||x(i||[])},E=o=>{const i=o.target.value;d({...r,id_recepcion:i,id_producto:""}),k(i)},f=()=>{d({id_recepcion:"",id_producto:"",motivo:"",cantidad:"",observaciones:""}),x([])},P=async()=>{if(!r.id_recepcion){n.error("Seleccione una recepción");return}if(!r.id_producto){n.error("Seleccione un producto");return}if(!r.motivo){n.error("Seleccione un motivo de devolución");return}const o=parseInt(r.cantidad);if(!o||o<=0){n.error("La cantidad debe ser mayor a 0");return}const i=b.find(a=>a.id_producto===r.id_producto);if(i&&o>i.cantidad_disponible){n.error(`Solo puedes devolver ${i.cantidad_disponible} unidades (Recibido: ${i.cantidad_recibida}, Ya devuelto: ${i.cantidad_devuelta})`);return}y(!0);try{const{data:a,error:g}=await c.rpc("fn_crear_devolucion_proveedor_v2",{p_id_recepcion:r.id_recepcion,p_id_producto:r.id_producto,p_motivo:r.motivo,p_cantidad:o,p_observaciones:r.observaciones||null,p_username:I()});g?(console.error("Error:",g),n.error(g.message||"Error al crear devolución")):(n.success(`Devolución ${a} creada exitosamente`),l(!1),f(),j())}catch(a){console.error("Error:",a),n.error("Error al crear devolución")}finally{y(!1)}},B=o=>{const i={DAÑO:{bg:"#ffebee",color:"#c62828",icon:e.jsx(m,{size:14})},VENCIDO:{bg:"#fff3e0",color:"#e65100",icon:e.jsx(_,{size:14})},SOBRANTE:{bg:"#e3f2fd",color:"#1565c0",icon:e.jsx(S,{size:14})},OTRO:{bg:"#f5f5f5",color:"#616161",icon:e.jsx(L,{size:14})}};return i[o]||i.OTRO},T=o=>new Date(o).toLocaleDateString("es-BO");return e.jsxs("div",{style:t.container,children:[e.jsx(W,{position:"top-right"}),e.jsxs("header",{style:t.header,children:[e.jsxs("div",{children:[e.jsxs("h1",{style:t.title,children:[e.jsx(h,{size:28,style:{marginRight:"12px"}}),"Devoluciones a Proveedor"]}),e.jsxs("p",{style:t.subtitle,children:["Gestión de devoluciones de mercadería • ",p.length," registros"]})]}),e.jsxs("button",{style:t.btnPrimary,onClick:()=>l(!0),children:[e.jsx(A,{size:18}),"Nueva Devolución"]})]}),e.jsxs("div",{style:t.infoCard,children:[e.jsx(m,{size:20,style:{color:"#e65100"}}),e.jsx("p",{children:"Registre devoluciones cuando detecte mercadería dañada, vencida o defectuosa. El stock se ajusta automáticamente."})]}),e.jsx("div",{style:t.tableContainer,children:w?e.jsxs("div",{style:t.loadingState,children:[e.jsx(z,{size:40,style:{animation:"spin 1s linear infinite",color:"#1a5d1a"}}),e.jsx("p",{children:"Cargando devoluciones..."})]}):p.length===0?e.jsxs("div",{style:t.emptyState,children:[e.jsx(h,{size:48,style:{color:"#ccc"}}),e.jsx("p",{children:"No hay devoluciones registradas"}),e.jsx("span",{style:{color:"#999"},children:'Haga clic en "Nueva Devolución" para registrar una'})]}):e.jsxs("table",{style:t.table,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:t.th,children:"Fecha"}),e.jsx("th",{style:t.th,children:"Producto"}),e.jsx("th",{style:t.th,children:"Cantidad"}),e.jsx("th",{style:t.th,children:"Motivo"})]})}),e.jsx("tbody",{children:p.map((o,i)=>{const a=B(o.motivo);return e.jsxs("tr",{style:t.tr,children:[e.jsx("td",{style:t.td,children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(_,{size:14,style:{color:"#6c757d"}}),T(o.fecha)]})}),e.jsx("td",{style:t.td,children:e.jsx("strong",{children:o.producto})}),e.jsx("td",{style:t.td,children:e.jsx("span",{style:t.cantidad,children:o.cantidad})}),e.jsx("td",{style:t.td,children:e.jsxs("span",{style:{...t.badge,background:a.bg,color:a.color},children:[a.icon,o.motivo]})})]},i)})})]})}),O&&e.jsx("div",{style:t.modalOverlay,children:e.jsxs("div",{style:t.modal,children:[e.jsxs("div",{style:t.modalHeader,children:[e.jsxs("h2",{style:t.modalTitle,children:[e.jsx(h,{size:22,style:{marginRight:"10px"}}),"Nueva Devolución a Proveedor"]}),e.jsx("button",{style:t.btnClose,onClick:()=>{l(!1),f()},children:e.jsx(N,{size:20})})]}),e.jsxs("div",{style:t.modalBody,children:[e.jsxs("div",{style:t.formGroup,children:[e.jsxs("label",{style:t.label,children:[e.jsx(F,{size:16}),"Buscar Ingreso (Recepción) *"]}),e.jsxs("select",{style:t.select,value:r.id_recepcion,onChange:E,children:[e.jsx("option",{value:"",children:"-- Seleccione una recepción --"}),R.map(o=>e.jsxs("option",{value:o.id_recepcion,children:[o.id_recepcion," | ",o.proveedor," | Lote: ",o.lote," | ",o.fecha_ingreso]},o.id_recepcion))]})]}),r.id_recepcion&&e.jsxs("div",{style:t.formGroup,children:[e.jsxs("label",{style:t.label,children:[e.jsx(S,{size:16}),"Seleccionar Producto *"]}),e.jsxs("select",{style:t.select,value:r.id_producto,onChange:o=>d({...r,id_producto:o.target.value}),children:[e.jsx("option",{value:"",children:"-- Seleccione un producto --"}),b.map(o=>e.jsxs("option",{value:o.id_producto,disabled:o.cantidad_disponible<=0,children:[o.nombre," | Recibido: ",o.cantidad_recibida," | Devuelto: ",o.cantidad_devuelta," | Disponible: ",o.cantidad_disponible]},o.id_producto))]})]}),e.jsxs("div",{style:t.formGroup,children:[e.jsxs("label",{style:t.label,children:[e.jsx(m,{size:16}),"Motivo de Devolución *"]}),e.jsxs("select",{style:t.select,value:r.motivo,onChange:o=>d({...r,motivo:o.target.value}),children:[e.jsx("option",{value:"",children:"-- Seleccione motivo --"}),e.jsx("option",{value:"DAÑO",children:"DAÑO - Producto dañado"}),e.jsx("option",{value:"VENCIDO",children:"VENCIDO - Producto vencido"}),e.jsx("option",{value:"SOBRANTE",children:"SOBRANTE - Exceso de inventario"}),e.jsx("option",{value:"OTRO",children:"OTRO - Otro motivo"})]})]}),e.jsxs("div",{style:t.formGroup,children:[e.jsx("label",{style:t.label,children:"Cantidad a Devolver *"}),e.jsx("input",{type:"number",style:t.input,placeholder:"Ej: 10",min:"1",value:r.cantidad,onChange:o=>d({...r,cantidad:o.target.value})})]}),e.jsxs("div",{style:t.formGroup,children:[e.jsx("label",{style:t.label,children:"Observaciones"}),e.jsx("textarea",{style:t.textarea,placeholder:"Detalles adicionales sobre la devolución...",rows:3,value:r.observaciones,onChange:o=>d({...r,observaciones:o.target.value})})]})]}),e.jsxs("div",{style:t.modalFooter,children:[e.jsx("button",{style:t.btnSecondary,onClick:()=>{l(!1),f()},children:"Cancelar"}),e.jsxs("button",{style:t.btnPrimary,onClick:P,disabled:u,children:[u?e.jsx(z,{size:16,style:{animation:"spin 1s linear infinite"}}):e.jsx(G,{size:16}),u?"Guardando...":"Confirmar Devolución"]})]})]})}),e.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]})}const t={container:{padding:"20px",maxWidth:"1100px",margin:"0 auto"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px",flexWrap:"wrap",gap:"15px"},title:{margin:0,fontSize:"28px",fontWeight:"700",color:"#1a5d1a",display:"flex",alignItems:"center"},subtitle:{margin:"8px 0 0 0",color:"#6c757d",fontSize:"14px"},btnPrimary:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 20px",background:"linear-gradient(135deg, #1a5d1a, #2e7d32)",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600",fontSize:"14px"},btnSecondary:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 20px",background:"#f5f5f5",color:"#333",border:"1px solid #ddd",borderRadius:"8px",cursor:"pointer",fontWeight:"500"},btnClose:{background:"transparent",border:"none",cursor:"pointer",color:"#999",padding:"5px"},infoCard:{display:"flex",alignItems:"flex-start",gap:"15px",padding:"20px",background:"#fff3e0",borderRadius:"12px",marginBottom:"20px",border:"1px solid #ffcc80"},tableContainer:{background:"white",borderRadius:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.05)",overflow:"auto"},table:{width:"100%",borderCollapse:"collapse"},th:{padding:"15px 20px",textAlign:"left",background:"#f8f9fa",color:"#1a5d1a",fontWeight:"600",fontSize:"14px",borderBottom:"2px solid #e9ecef"},tr:{borderBottom:"1px solid #e9ecef"},td:{padding:"15px 20px",fontSize:"14px",color:"#495057"},cantidad:{padding:"4px 12px",background:"#f8f9fa",borderRadius:"20px",fontWeight:"600"},badge:{display:"inline-flex",alignItems:"center",gap:"5px",padding:"6px 12px",borderRadius:"20px",fontSize:"12px",fontWeight:"600"},loadingState:{display:"flex",flexDirection:"column",alignItems:"center",padding:"60px",color:"#6c757d",gap:"15px"},emptyState:{display:"flex",flexDirection:"column",alignItems:"center",padding:"60px",color:"#6c757d",gap:"15px",textAlign:"center"},modalOverlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3},modal:{background:"white",borderRadius:"16px",width:"90%",maxWidth:"550px",maxHeight:"90vh",overflow:"auto",boxShadow:"0 20px 50px rgba(0,0,0,0.2)"},modalHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 25px",borderBottom:"1px solid #e9ecef"},modalTitle:{margin:0,fontSize:"20px",fontWeight:"600",color:"#1a5d1a",display:"flex",alignItems:"center"},modalBody:{padding:"25px"},modalFooter:{display:"flex",justifyContent:"flex-end",gap:"12px",padding:"20px 25px",borderTop:"1px solid #e9ecef",background:"#f8f9fa"},formGroup:{marginBottom:"20px"},label:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px",fontWeight:"500",color:"#333",fontSize:"14px"},input:{width:"100%",padding:"12px 15px",border:"1px solid #ddd",borderRadius:"8px",fontSize:"14px",boxSizing:"border-box"},select:{width:"100%",padding:"12px 15px",border:"1px solid #ddd",borderRadius:"8px",fontSize:"14px",boxSizing:"border-box",background:"white"},textarea:{width:"100%",padding:"12px 15px",border:"1px solid #ddd",borderRadius:"8px",fontSize:"14px",boxSizing:"border-box",resize:"vertical"}};export{Y as default};
