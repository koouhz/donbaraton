import{r as n,s as u,j as e,B as S,X as w}from"./index-DyRGlXyn.js";import{n as l,F as O,L as I}from"./index-Bk6qzOxF.js";import{P as B}from"./plus-CAyMjqEC.js";import{S as L}from"./search-BOAzkQOY.js";import{U as X}from"./user-QSq5DbPw.js";import{P as U}from"./phone-YHHZqysP.js";import{M as q}from"./mail-CCnOYG6G.js";import{S as H}from"./square-pen-DfFVALX3.js";import{T as Z}from"./trash-2-CTuwllM0.js";import{S as J}from"./save-C8gd7RBd.js";function ae(){const[f,z]=n.useState([]),[k,_]=n.useState(!0),[h,x]=n.useState(!1),[d,v]=n.useState(""),[R,s]=n.useState(!1),[m,g]=n.useState(null),[o,i]=n.useState({nombres:"",apellido_paterno:"",apellido_materno:"",ci_nit:"",telefono:"",email:"",direccion:""}),y=()=>{const r=localStorage.getItem("user");if(r)try{return JSON.parse(r).username||"admin"}catch{return"admin"}return"admin"};n.useEffect(()=>{c()},[]);const c=async()=>{_(!0);try{const{data:r,error:a}=await u.rpc("fn_listar_clientes",{p_busqueda:d||null});if(a)console.error("Error:",a),l.error("Error al cargar clientes");else{const p=(r||[]).sort((F,P)=>{const $=parseInt((F.id_cliente||"").replace(/\D/g,"")||"0");return parseInt((P.id_cliente||"").replace(/\D/g,"")||"0")-$});z(p)}}catch(r){console.error("Error:",r),l.error("Error de conexión")}finally{_(!1)}};n.useEffect(()=>{const r=setTimeout(()=>{c()},300);return()=>clearTimeout(r)},[d]);const b=/^[a-zA-ZáéíóúÁÉÍÓÚñÑ\s-]+$/,T=/^[0-9A-Z-]{7,12}$/i,N=/^\d{8}$/,W=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,C=()=>o.nombres.trim()?b.test(o.nombres.trim())?o.apellido_paterno&&!b.test(o.apellido_paterno.trim())?(l.error("El apellido paterno solo puede contener letras"),!1):o.apellido_materno&&!b.test(o.apellido_materno.trim())?(l.error("El apellido materno solo puede contener letras"),!1):o.ci_nit.trim()?T.test(o.ci_nit.trim())?o.telefono&&!N.test(o.telefono.trim())?(l.error("El teléfono debe tener exactamente 8 dígitos numéricos"),!1):o.email&&!W.test(o.email.trim())?(l.error("El formato del correo electrónico es inválido"),!1):!0:(l.error("El CI/NIT debe tener entre 7 y 12 caracteres alfanuméricos"),!1):(l.error("El CI/NIT es obligatorio"),!1):(l.error("El nombre solo puede contener letras y espacios"),!1):(l.error("El nombre es obligatorio"),!1),A=async()=>{if(C()){x(!0);try{const{data:r,error:a}=await u.rpc("fn_crear_cliente",{p_nombres:o.nombres.trim(),p_apellido_paterno:o.apellido_paterno.trim()||null,p_apellido_materno:o.apellido_materno.trim()||null,p_ci_nit:o.ci_nit.trim(),p_telefono:o.telefono.trim()||null,p_email:o.email.trim()||null,p_direccion:o.direccion.trim()||null,p_usuario_auditoria:y()});a?a.message.includes("ya existe")?l.error("El CI/NIT ya está registrado"):l.error(a.message||"Error al crear cliente"):(l.success("Cliente creado exitosamente"),s(!1),j(),c())}catch{l.error("Error al crear cliente")}finally{x(!1)}}},G=async()=>{if(C()){x(!0);try{const{error:r}=await u.rpc("fn_actualizar_cliente",{p_id:m.id_cliente,p_nombres:o.nombres.trim(),p_apellido_paterno:o.apellido_paterno.trim()||null,p_apellido_materno:o.apellido_materno.trim()||null,p_ci_nit:o.ci_nit.trim(),p_telefono:o.telefono.trim()||null,p_email:o.email.trim()||null,p_direccion:o.direccion.trim()||null,p_usuario_auditoria:y()});r?r.message.includes("ya está registrado")?l.error("El CI/NIT ya está registrado para otro cliente"):l.error(r.message||"Error al actualizar"):(l.success("Cliente actualizado exitosamente"),s(!1),j(),c())}catch{l.error("Error al actualizar")}finally{x(!1)}}},M=async(r,a)=>{if(window.confirm(`¿Eliminar el cliente "${a}"?`))try{const{error:p}=await u.rpc("fn_eliminar_cliente",{p_id:r,p_usuario_auditoria:y()});p?l.error(p.message||"Error al eliminar"):(l.success("Cliente eliminado"),c())}catch{l.error("Error al eliminar")}},D=r=>{g(r),i({nombres:r.nombres||"",apellido_paterno:r.apellido_paterno||"",apellido_materno:r.apellido_materno||"",ci_nit:r.ci_nit||"",telefono:r.telefono||"",email:r.email||"",direccion:r.direccion||""}),s(!0)},E=()=>{g(null),j(),s(!0)},j=()=>{i({nombres:"",apellido_paterno:"",apellido_materno:"",ci_nit:"",telefono:"",email:"",direccion:""}),g(null)};return e.jsxs("div",{style:t.container,children:[e.jsx(O,{position:"top-right"}),e.jsxs("header",{style:t.header,children:[e.jsxs("div",{children:[e.jsxs("h1",{style:t.title,children:[e.jsx(S,{size:28,style:{marginRight:"12px"}}),"Clientes"]}),e.jsxs("p",{style:t.subtitle,children:["Gestión de clientes • ",f.length," registros"]})]}),e.jsxs("button",{style:t.primaryButton,onClick:E,children:[e.jsx(B,{size:18}),"Nuevo Cliente"]})]}),e.jsx("div",{style:t.toolbar,children:e.jsxs("div",{style:t.searchBox,children:[e.jsx(L,{size:18,style:{color:"#6c757d"}}),e.jsx("input",{type:"text",placeholder:"Buscar por nombre o CI/NIT...",value:d,onChange:r=>v(r.target.value),style:t.searchInput}),d&&e.jsx("button",{onClick:()=>v(""),style:t.clearButton,children:e.jsx(w,{size:16})})]})}),e.jsx("div",{style:t.tableContainer,children:k?e.jsxs("div",{style:t.loadingState,children:[e.jsx(I,{size:40,style:{animation:"spin 1s linear infinite",color:"#1a5d1a"}}),e.jsx("p",{children:"Cargando clientes..."})]}):f.length===0?e.jsxs("div",{style:t.emptyState,children:[e.jsx(S,{size:48,style:{color:"#ccc"}}),e.jsx("p",{children:d?"No se encontraron resultados":"No hay clientes registrados"}),!d&&e.jsxs("button",{style:t.primaryButton,onClick:E,children:[e.jsx(B,{size:18})," Crear primer cliente"]})]}):e.jsxs("table",{style:t.table,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:t.th,children:"Nombres"}),e.jsx("th",{style:t.th,children:"Ap. Paterno"}),e.jsx("th",{style:t.th,children:"Ap. Materno"}),e.jsx("th",{style:t.th,children:"CI/NIT"}),e.jsx("th",{style:t.th,children:"Teléfono"}),e.jsx("th",{style:t.th,children:"Email"}),e.jsx("th",{style:{...t.th,textAlign:"center"},children:"Acciones"})]})}),e.jsx("tbody",{children:f.map(r=>e.jsxs("tr",{style:t.tr,children:[e.jsx("td",{style:t.td,children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("div",{style:t.avatar,children:e.jsx(X,{size:16})}),e.jsx("strong",{children:`${r.nombres} ${r.apellido_paterno||""} ${r.apellido_materno||""}`.trim()})]})}),e.jsx("td",{style:t.td,children:r.apellido_paterno||e.jsx("span",{style:{color:"#999"},children:"-"})}),e.jsx("td",{style:t.td,children:r.apellido_materno||e.jsx("span",{style:{color:"#999"},children:"-"})}),e.jsx("td",{style:t.td,children:e.jsx("span",{style:t.ciBadge,children:r.ci_nit})}),e.jsx("td",{style:t.td,children:r.telefono?e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"5px"},children:[e.jsx(U,{size:14,style:{color:"#1a5d1a"}})," ",r.telefono]}):e.jsx("span",{style:{color:"#999"},children:"-"})}),e.jsx("td",{style:t.td,children:r.email?e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"5px"},children:[e.jsx(q,{size:14,style:{color:"#1976d2"}}),e.jsx("span",{style:{maxWidth:"180px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},title:r.email,children:r.email})]}):e.jsx("span",{style:{color:"#999"},children:"-"})}),e.jsx("td",{style:{...t.td,textAlign:"center"},children:e.jsxs("div",{style:t.actionButtons,children:[e.jsx("button",{type:"button",style:t.editButton,onClick:()=>D(r),title:"Editar cliente",children:e.jsx(H,{size:16})}),e.jsx("button",{type:"button",style:t.deleteButton,onClick:()=>M(r.id_cliente,r.nombre_completo),title:"Eliminar cliente",children:e.jsx(Z,{size:16})})]})})]},r.id_cliente))})]})}),R&&e.jsx("div",{style:t.modalOverlay,onClick:()=>s(!1),children:e.jsxs("div",{style:t.modal,onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{style:t.modalHeader,children:[e.jsx("h2",{style:t.modalTitle,children:m?"Editar Cliente":"Nuevo Cliente"}),e.jsx("button",{style:t.closeButton,onClick:()=>s(!1),children:e.jsx(w,{size:20})})]}),e.jsxs("div",{style:t.modalBody,children:[e.jsxs("div",{style:t.formRow,children:[e.jsxs("div",{style:t.formGroup,children:[e.jsx("label",{style:t.label,children:"Nombres *"}),e.jsx("input",{type:"text",value:o.nombres,onChange:r=>i({...o,nombres:r.target.value}),style:t.input,placeholder:"Nombres"})]}),e.jsxs("div",{style:t.formGroup,children:[e.jsx("label",{style:t.label,children:"Apellido Paterno"}),e.jsx("input",{type:"text",value:o.apellido_paterno,onChange:r=>i({...o,apellido_paterno:r.target.value}),style:t.input,placeholder:"Apellido Paterno"})]})]}),e.jsxs("div",{style:t.formRow,children:[e.jsxs("div",{style:t.formGroup,children:[e.jsx("label",{style:t.label,children:"Apellido Materno"}),e.jsx("input",{type:"text",value:o.apellido_materno,onChange:r=>i({...o,apellido_materno:r.target.value}),style:t.input,placeholder:"Apellido Materno"})]}),e.jsxs("div",{style:t.formGroup,children:[e.jsx("label",{style:t.label,children:"CI/NIT *"}),e.jsx("input",{type:"text",value:o.ci_nit,onChange:r=>i({...o,ci_nit:r.target.value}),style:t.input,placeholder:"Carnet o NIT"})]})]}),e.jsx("div",{style:t.formRow,children:e.jsxs("div",{style:t.formGroup,children:[e.jsx("label",{style:t.label,children:"Teléfono"}),e.jsx("input",{type:"tel",value:o.telefono,onChange:r=>i({...o,telefono:r.target.value}),style:t.input,placeholder:"Número de teléfono"})]})}),e.jsxs("div",{style:t.formGroup,children:[e.jsx("label",{style:t.label,children:"Email"}),e.jsx("input",{type:"email",value:o.email,onChange:r=>i({...o,email:r.target.value}),style:t.input,placeholder:"correo@ejemplo.com"})]}),e.jsxs("div",{style:t.formGroup,children:[e.jsx("label",{style:t.label,children:"Dirección"}),e.jsx("input",{type:"text",value:o.direccion,onChange:r=>i({...o,direccion:r.target.value}),style:t.input,placeholder:"Dirección del cliente"})]})]}),e.jsxs("div",{style:t.modalFooter,children:[e.jsx("button",{style:t.cancelButton,onClick:()=>s(!1),disabled:h,children:"Cancelar"}),e.jsx("button",{style:t.saveButton,onClick:m?G:A,disabled:h,children:h?e.jsxs(e.Fragment,{children:[e.jsx(I,{size:16,style:{animation:"spin 1s linear infinite"}})," Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{size:16})," ",m?"Actualizar":"Crear"]})})]})]})}),e.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]})}const t={container:{padding:"20px",maxWidth:"1400px",margin:"0 auto"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"25px",flexWrap:"wrap",gap:"15px"},title:{margin:0,fontSize:"28px",fontWeight:"700",color:"#1a5d1a",display:"flex",alignItems:"center"},subtitle:{margin:"8px 0 0 0",color:"#6c757d",fontSize:"14px"},primaryButton:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 20px",background:"linear-gradient(135deg, #1a5d1a, #2e8b57)",color:"white",border:"none",borderRadius:"10px",fontSize:"14px",fontWeight:"600",cursor:"pointer",boxShadow:"0 4px 12px rgba(26, 93, 26, 0.3)"},toolbar:{display:"flex",gap:"12px",marginBottom:"20px",flexWrap:"wrap"},searchBox:{display:"flex",alignItems:"center",gap:"10px",padding:"10px 15px",background:"white",border:"1px solid #e9ecef",borderRadius:"10px",flex:1,maxWidth:"400px"},searchInput:{border:"none",outline:"none",fontSize:"14px",width:"100%",background:"transparent"},clearButton:{background:"none",border:"none",cursor:"pointer",color:"#999",padding:"2px"},tableContainer:{background:"white",borderRadius:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.05)",overflow:"auto"},table:{width:"100%",borderCollapse:"collapse",minWidth:"1100px"},th:{padding:"12px 15px",textAlign:"left",background:"#f8f9fa",color:"#1a5d1a",fontWeight:"600",fontSize:"13px",borderBottom:"2px solid #e9ecef",whiteSpace:"nowrap"},tr:{borderBottom:"1px solid #e9ecef"},td:{padding:"12px 15px",fontSize:"13px",color:"#495057"},avatar:{width:"32px",height:"32px",borderRadius:"50%",background:"linear-gradient(135deg, #1a5d1a, #2e8b57)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",flexShrink:0},actionButtons:{display:"flex",gap:"8px",justifyContent:"center"},editButton:{padding:"8px",background:"#e3f2fd",border:"none",borderRadius:"8px",cursor:"pointer",color:"#1976d2",transition:"all 0.2s"},deleteButton:{padding:"8px",background:"#ffebee",border:"none",borderRadius:"8px",cursor:"pointer",color:"#d32f2f",transition:"all 0.2s"},loadingState:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"60px 20px",color:"#6c757d",gap:"15px"},emptyState:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"60px 20px",color:"#6c757d",gap:"15px"},modalOverlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"20px"},modal:{background:"white",borderRadius:"16px",width:"100%",maxWidth:"600px",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.3)",overflow:"hidden"},modalHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 25px",borderBottom:"1px solid #e9ecef",background:"linear-gradient(135deg, #f8f9fa, #e8f5e9)"},modalTitle:{margin:0,fontSize:"20px",fontWeight:"600",color:"#1a5d1a"},closeButton:{background:"none",border:"none",cursor:"pointer",color:"#6c757d",padding:"5px",borderRadius:"5px"},modalBody:{padding:"25px"},formRow:{display:"flex",gap:"15px",marginBottom:"15px",flexWrap:"wrap"},formGroup:{flex:1,minWidth:"200px",marginBottom:"15px"},label:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500",color:"#1a5d1a"},input:{width:"100%",padding:"12px 15px",border:"2px solid #e9ecef",borderRadius:"10px",fontSize:"14px",outline:"none",boxSizing:"border-box"},modalFooter:{display:"flex",justifyContent:"flex-end",gap:"12px",padding:"20px 25px",borderTop:"1px solid #e9ecef",background:"#f8f9fa"},cancelButton:{padding:"10px 20px",background:"white",border:"1px solid #e9ecef",borderRadius:"8px",fontSize:"14px",cursor:"pointer",color:"#6c757d"},saveButton:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 20px",background:"linear-gradient(135deg, #1a5d1a, #2e8b57)",color:"white",border:"none",borderRadius:"8px",fontSize:"14px",fontWeight:"500",cursor:"pointer"},ciBadge:{padding:"4px 10px",borderRadius:"6px",fontSize:"12px",fontWeight:"600",background:"#e3f2fd",color:"#1565c0",border:"1px solid #bbdefb"}};export{ae as default};
