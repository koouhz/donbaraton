import{u as _,r as x,s as g,j as e,P as m,b as k,W as I}from"./index-DyRGlXyn.js";import{n as S,F as R,L as z}from"./index-Bk6qzOxF.js";import{F}from"./file-chart-column-increasing-CW4iBOj0.js";import{T as u}from"./trending-up-CNeeSLoG.js";import{A as d}from"./arrow-right-CskIU4lv.js";import{D as V}from"./dollar-sign-BJpoOmkd.js";function E(){const i=_(),[f,y]=x.useState(!0),[p,v]=x.useState([]),[h,b]=x.useState([]);x.useEffect(()=>{C()},[]);const C=async()=>{y(!0);const s=new Date,r=new Date(s.getFullYear(),s.getMonth(),1).toISOString().split("T")[0],n=s.toISOString().split("T")[0];try{const[o,l]=await Promise.all([g.rpc("fn_reporte_rentabilidad_producto",{p_fecha_inicio:r,p_fecha_fin:n}),g.rpc("fn_reporte_inventario_valorado")]);o.error&&console.error("Error rentabilidad:",o.error),l.error&&console.error("Error inventario:",l.error),v(o.data||[]),b(l.data||[])}catch(o){console.error("Error:",o),S.error("Error al cargar reportes")}finally{y(!1)}},a=s=>`Bs ${parseFloat(s||0).toFixed(2)}`,c=h.reduce((s,r)=>({productos:s.productos+parseInt(r.cantidad_productos||0),stock:s.stock+parseInt(r.stock_total||0),valorCosto:s.valorCosto+parseFloat(r.valor_costo_total||0),valorVenta:s.valorVenta+parseFloat(r.valor_venta_potencial||0)}),{productos:0,stock:0,valorCosto:0,valorVenta:0}),j=p.reduce((s,r)=>{const n=parseInt(r.cantidad_vendida||0),o=n*parseFloat(r.precio_venta||0),l=n*parseFloat(r.precio_costo||0);return{ingreso:s.ingreso+o,costo:s.costo+l,ganancia:s.ganancia+parseFloat(r.ganancia_total||0)}},{ingreso:0,costo:0,ganancia:0});return e.jsxs("div",{style:t.container,children:[e.jsx(R,{position:"top-right"}),e.jsx("header",{style:t.header,children:e.jsxs("div",{children:[e.jsxs("h1",{style:t.title,children:[e.jsx(F,{size:28,style:{marginRight:"12px"}}),"Reportes"]}),e.jsx("p",{style:t.subtitle,children:"Centro de análisis y reportes del sistema"})]})}),e.jsxs("div",{style:t.quickLinks,children:[e.jsxs("button",{style:t.linkCard,onClick:()=>i("/reportes-ventas"),children:[e.jsx(u,{size:24,style:{color:"#1a5d1a"}}),e.jsxs("div",{children:[e.jsx("strong",{children:"Reportes de Ventas"}),e.jsx("span",{children:"Análisis de ventas por período"})]}),e.jsx(d,{size:20,style:{color:"#ccc"}})]}),e.jsxs("button",{style:t.linkCard,onClick:()=>i("/reportes-rentabilidad"),children:[e.jsx(V,{size:24,style:{color:"#2e7d32"}}),e.jsxs("div",{children:[e.jsx("strong",{children:"Rentabilidad por Producto"}),e.jsx("span",{children:"Márgenes y ganancias"})]}),e.jsx(d,{size:20,style:{color:"#ccc"}})]}),e.jsxs("button",{style:t.linkCard,onClick:()=>i("/reportes-inventario"),children:[e.jsx(m,{size:24,style:{color:"#1565c0"}}),e.jsxs("div",{children:[e.jsx("strong",{children:"Inventario Valorado"}),e.jsx("span",{children:"Stock por categoría y alertas"})]}),e.jsx(d,{size:20,style:{color:"#ccc"}})]}),e.jsxs("button",{style:t.linkCard,onClick:()=>i("/balance-general"),children:[e.jsx(k,{size:24,style:{color:"#e65100"}}),e.jsxs("div",{children:[e.jsx("strong",{children:"Balance General"}),e.jsx("span",{children:"Resumen financiero"})]}),e.jsx(d,{size:20,style:{color:"#ccc"}})]}),e.jsxs("button",{style:t.linkCard,onClick:()=>i("/reportes-compras"),children:[e.jsx(I,{size:24,style:{color:"#7b1fa2"}}),e.jsxs("div",{children:[e.jsx("strong",{children:"Reportes de Compras"}),e.jsx("span",{children:"Historial de compras"})]}),e.jsx(d,{size:20,style:{color:"#ccc"}})]})]}),f?e.jsxs("div",{style:t.loadingState,children:[e.jsx(z,{size:40,style:{animation:"spin 1s linear infinite",color:"#1a5d1a"}}),e.jsx("p",{children:"Cargando reportes..."})]}):e.jsxs("div",{style:t.reportsGrid,children:[e.jsxs("div",{style:t.reportCard,children:[e.jsxs("h3",{style:t.reportTitle,children:[e.jsx(m,{size:20}),"Inventario Valorado por Categoría"]}),e.jsxs("div",{style:t.summaryRow,children:[e.jsxs("div",{style:t.summaryItem,children:[e.jsx("span",{children:c.productos}),e.jsx("label",{children:"Productos"})]}),e.jsxs("div",{style:t.summaryItem,children:[e.jsx("span",{children:c.stock}),e.jsx("label",{children:"Unidades"})]}),e.jsxs("div",{style:t.summaryItem,children:[e.jsx("span",{style:{color:"#1a5d1a"},children:a(c.valorCosto)}),e.jsx("label",{children:"Valor Costo"})]}),e.jsxs("div",{style:t.summaryItem,children:[e.jsx("span",{style:{color:"#2e7d32"},children:a(c.valorVenta)}),e.jsx("label",{children:"Valor Venta"})]})]}),h.length>0?e.jsx("div",{style:t.tableWrapper,children:e.jsxs("table",{style:t.table,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:t.th,children:"Categoría"}),e.jsx("th",{style:t.th,children:"Productos"}),e.jsx("th",{style:t.th,children:"Stock"}),e.jsx("th",{style:t.th,children:"Valor Costo"}),e.jsx("th",{style:t.th,children:"Valor Venta"})]})}),e.jsx("tbody",{children:h.slice(0,10).map((s,r)=>e.jsxs("tr",{style:t.tr,children:[e.jsx("td",{style:t.td,children:e.jsx("strong",{children:s.categoria})}),e.jsx("td",{style:t.td,children:s.cantidad_productos}),e.jsx("td",{style:t.td,children:s.stock_total}),e.jsx("td",{style:t.td,children:a(s.valor_costo_total)}),e.jsx("td",{style:{...t.td,color:"#2e7d32",fontWeight:"600"},children:a(s.valor_venta_potencial)})]},r))})]})}):e.jsx("div",{style:t.emptyState,children:"No hay datos"})]}),e.jsxs("div",{style:t.reportCard,children:[e.jsxs("h3",{style:t.reportTitle,children:[e.jsx(u,{size:20}),"Rentabilidad del Mes"]}),e.jsxs("div",{style:t.summaryRow,children:[e.jsxs("div",{style:t.summaryItem,children:[e.jsx("span",{children:a(j.ingreso)}),e.jsx("label",{children:"Ingresos"})]}),e.jsxs("div",{style:t.summaryItem,children:[e.jsx("span",{style:{color:"#c62828"},children:a(j.costo)}),e.jsx("label",{children:"Costos"})]}),e.jsxs("div",{style:t.summaryItem,children:[e.jsx("span",{style:{color:"#2e7d32",fontSize:"20px"},children:a(j.ganancia)}),e.jsx("label",{children:"Ganancia Bruta"})]})]}),p.length>0?e.jsx("div",{style:t.tableWrapper,children:e.jsxs("table",{style:t.table,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:t.th,children:"Producto"}),e.jsx("th",{style:t.th,children:"Vendidos"}),e.jsx("th",{style:t.th,children:"Ingreso"}),e.jsx("th",{style:t.th,children:"Ganancia"}),e.jsx("th",{style:t.th,children:"Margen"})]})}),e.jsx("tbody",{children:p.slice(0,10).map((s,r)=>{const n=parseInt(s.cantidad_vendida||0)*parseFloat(s.precio_venta||0),o=s.precio_venta>0?((s.precio_venta-s.precio_costo)/s.precio_venta*100).toFixed(1):0;return e.jsxs("tr",{style:t.tr,children:[e.jsx("td",{style:t.td,children:e.jsx("strong",{children:s.producto})}),e.jsx("td",{style:t.td,children:s.cantidad_vendida}),e.jsx("td",{style:t.td,children:a(n)}),e.jsx("td",{style:{...t.td,color:"#2e7d32",fontWeight:"600"},children:a(s.ganancia_total)}),e.jsx("td",{style:t.td,children:e.jsxs("span",{style:{...t.badge,background:parseFloat(o)>=20?"#e8f5e9":"#fff3e0",color:parseFloat(o)>=20?"#2e7d32":"#e65100"},children:[o,"%"]})})]},r)})})]})}):e.jsx("div",{style:t.emptyState,children:"No hay datos de ventas este mes"})]})]}),e.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]})}const t={container:{padding:"20px",maxWidth:"1400px",margin:"0 auto"},header:{marginBottom:"20px"},title:{margin:0,fontSize:"28px",fontWeight:"700",color:"#1a5d1a",display:"flex",alignItems:"center"},subtitle:{margin:"8px 0 0 0",color:"#6c757d",fontSize:"14px"},quickLinks:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(280px, 1fr))",gap:"15px",marginBottom:"25px"},linkCard:{display:"flex",alignItems:"center",gap:"15px",padding:"20px",background:"white",border:"1px solid #e9ecef",borderRadius:"12px",cursor:"pointer",textAlign:"left",transition:"all 0.2s"},reportsGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(500px, 1fr))",gap:"20px"},reportCard:{background:"white",borderRadius:"16px",padding:"25px",boxShadow:"0 2px 12px rgba(0,0,0,0.05)"},reportTitle:{display:"flex",alignItems:"center",gap:"10px",margin:"0 0 20px 0",fontSize:"16px",fontWeight:"600",color:"#333"},summaryRow:{display:"flex",gap:"20px",marginBottom:"20px",padding:"15px",background:"#f8f9fa",borderRadius:"10px",flexWrap:"wrap"},summaryItem:{textAlign:"center",flex:1,minWidth:"80px"},tableWrapper:{maxHeight:"300px",overflowY:"auto"},table:{width:"100%",borderCollapse:"collapse"},th:{padding:"12px 15px",textAlign:"left",background:"#f8f9fa",color:"#1a5d1a",fontWeight:"600",fontSize:"13px",borderBottom:"2px solid #e9ecef",position:"sticky",top:0},tr:{borderBottom:"1px solid #e9ecef"},td:{padding:"12px 15px",fontSize:"13px",color:"#495057"},badge:{padding:"4px 10px",borderRadius:"20px",fontSize:"12px",fontWeight:"600"},loadingState:{display:"flex",flexDirection:"column",alignItems:"center",padding:"80px",color:"#6c757d",gap:"15px"},emptyState:{textAlign:"center",padding:"40px",color:"#6c757d"}};export{E as default};
