import{r as n,s as u,j as e,T as v,X as z}from"./index-DyRGlXyn.js";import{n as l,F as P,L as C}from"./index-Bk6qzOxF.js";import{P as N}from"./plus-CAyMjqEC.js";import{S as W}from"./search-BOAzkQOY.js";import{P as G}from"./phone-YHHZqysP.js";import{M as F}from"./mail-CCnOYG6G.js";import{S as D}from"./square-pen-DfFVALX3.js";import{T as M}from"./trash-2-CTuwllM0.js";import{S as A}from"./save-C8gd7RBd.js";function K(){const[m,S]=n.useState([]),[w,j]=n.useState(!0),[h,x]=n.useState(!1),[c,_]=n.useState(""),[I,s]=n.useState(!1),[d,f]=n.useState(null),[o,a]=n.useState({razon_social:"",nit_ci:"",telefono:"",celular:"",email:"",direccion:"",nombre_contacto:"",plazo_credito:30}),g=()=>{const t=localStorage.getItem("user");if(t)try{return JSON.parse(t).usuario_id||"USR-001"}catch{return"USR-001"}return"USR-001"};n.useEffect(()=>{p()},[]);const p=async()=>{j(!0);try{const{data:t,error:i}=await u.rpc("fn_leer_proveedores",{p_buscar_texto:c||null});i?(console.error("Error:",i),l.error("Error al cargar proveedores")):S(t||[])}catch(t){console.error("Error:",t),l.error("Error de conexión")}finally{j(!1)}};n.useEffect(()=>{const t=setTimeout(()=>{p()},300);return()=>clearTimeout(t)},[c]);const B=async()=>{if(!o.razon_social.trim()||!o.nit_ci.trim()){l.error("Razón social y NIT/CI son obligatorios");return}x(!0);try{const{data:t,error:i}=await u.rpc("fn_crear_proveedor",{p_razon_social:o.razon_social.trim(),p_nit_ci:o.nit_ci.trim(),p_telefono:o.telefono.trim()||null,p_celular_contacto:o.celular.trim()||null,p_email:o.email.trim()||null,p_direccion:o.direccion.trim()||null,p_nombre_contacto:o.nombre_contacto.trim()||null,p_plazo_credito:parseInt(o.plazo_credito)||30,p_usuario_auditoria:g()});i?i.message.includes("ya existe")?l.error("El NIT/CI ya está registrado"):l.error(i.message||"Error al crear proveedor"):(l.success("Proveedor creado exitosamente"),s(!1),y(),p())}catch{l.error("Error al crear proveedor")}finally{x(!1)}},k=async()=>{if(!o.razon_social.trim()){l.error("La razón social es obligatoria");return}x(!0);try{const{error:t}=await u.rpc("fn_actualizar_proveedor",{p_id_proveedor:d.id,p_razon_social:o.razon_social.trim(),p_nit_ci:o.nit_ci.trim(),p_telefono:o.telefono.trim()||null,p_celular_contacto:o.celular.trim()||null,p_email:o.email.trim()||null,p_direccion:o.direccion.trim()||null,p_nombre_contacto:o.nombre_contacto.trim()||null,p_plazo_credito:parseInt(o.plazo_credito)||30,p_usuario_auditoria:g()});t?l.error(t.message||"Error al actualizar"):(l.success("Proveedor actualizado exitosamente"),s(!1),y(),p())}catch{l.error("Error al actualizar")}finally{x(!1)}},R=async(t,i)=>{if(window.confirm(`¿Eliminar el proveedor "${i}"?`))try{const{error:b}=await u.rpc("fn_eliminar_proveedor",{p_id_proveedor:t,p_usuario_auditoria:g()});b?l.error(b.message||"Error al eliminar"):(l.success("Proveedor eliminado"),p())}catch{l.error("Error al eliminar")}},E=t=>{f(t),a({razon_social:t.razon_social||"",nit_ci:t.nit_ci||"",telefono:t.telefono||"",celular:"",email:t.email||"",direccion:"",nombre_contacto:t.nombre_contacto||"",plazo_credito:30}),s(!0)},T=()=>{f(null),y(),s(!0)},y=()=>{a({razon_social:"",nit_ci:"",telefono:"",celular:"",email:"",direccion:"",nombre_contacto:"",plazo_credito:30}),f(null)};return e.jsxs("div",{style:r.container,children:[e.jsx(P,{position:"top-right"}),e.jsxs("header",{style:r.header,children:[e.jsxs("div",{children:[e.jsxs("h1",{style:r.title,children:[e.jsx(v,{size:28,style:{marginRight:"12px"}}),"Proveedores"]}),e.jsxs("p",{style:r.subtitle,children:["Gestión de proveedores • ",m.length," registros"]})]}),e.jsxs("button",{style:r.primaryButton,onClick:T,children:[e.jsx(N,{size:18}),"Nuevo Proveedor"]})]}),e.jsx("div",{style:r.toolbar,children:e.jsxs("div",{style:r.searchBox,children:[e.jsx(W,{size:18,style:{color:"#6c757d"}}),e.jsx("input",{type:"text",placeholder:"Buscar por nombre o NIT...",value:c,onChange:t=>_(t.target.value),style:r.searchInput}),c&&e.jsx("button",{onClick:()=>_(""),style:r.clearButton,children:e.jsx(z,{size:16})})]})}),e.jsx("div",{style:r.tableContainer,children:w?e.jsxs("div",{style:r.loadingState,children:[e.jsx(C,{size:40,style:{animation:"spin 1s linear infinite",color:"#1a5d1a"}}),e.jsx("p",{children:"Cargando proveedores..."})]}):m.length===0?e.jsxs("div",{style:r.emptyState,children:[e.jsx(v,{size:48,style:{color:"#ccc"}}),e.jsx("p",{children:c?"No se encontraron resultados":"No hay proveedores registrados"})]}):e.jsxs("table",{style:r.table,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:r.th,children:"Razón Social"}),e.jsx("th",{style:r.th,children:"NIT/CI"}),e.jsx("th",{style:r.th,children:"Contacto"}),e.jsx("th",{style:r.th,children:"Teléfono"}),e.jsx("th",{style:r.th,children:"Email"}),e.jsx("th",{style:{...r.th,textAlign:"center"},children:"Acciones"})]})}),e.jsx("tbody",{children:m.map(t=>e.jsxs("tr",{style:r.tr,children:[e.jsx("td",{style:r.td,children:e.jsx("strong",{children:t.razon_social})}),e.jsx("td",{style:r.td,children:t.nit_ci}),e.jsx("td",{style:r.td,children:t.nombre_contacto||"-"}),e.jsx("td",{style:r.td,children:t.telefono?e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"5px"},children:[e.jsx(G,{size:14})," ",t.telefono]}):"-"}),e.jsx("td",{style:r.td,children:t.email?e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"5px"},children:[e.jsx(F,{size:14})," ",t.email]}):"-"}),e.jsx("td",{style:{...r.td,textAlign:"center"},children:e.jsxs("div",{style:r.actionButtons,children:[e.jsx("button",{style:r.editButton,onClick:()=>E(t),children:e.jsx(D,{size:16})}),e.jsx("button",{style:r.deleteButton,onClick:()=>R(t.id,t.razon_social),children:e.jsx(M,{size:16})})]})})]},t.id))})]})}),I&&e.jsx("div",{style:r.modalOverlay,onClick:()=>s(!1),children:e.jsxs("div",{style:r.modal,onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{style:r.modalHeader,children:[e.jsx("h2",{style:r.modalTitle,children:d?"Editar Proveedor":"Nuevo Proveedor"}),e.jsx("button",{style:r.closeButton,onClick:()=>s(!1),children:e.jsx(z,{size:20})})]}),e.jsxs("div",{style:r.modalBody,children:[e.jsxs("div",{style:r.formRow,children:[e.jsxs("div",{style:r.formGroup,children:[e.jsx("label",{style:r.label,children:"Razón Social *"}),e.jsx("input",{type:"text",value:o.razon_social,onChange:t=>a({...o,razon_social:t.target.value}),style:r.input,placeholder:"Nombre de la empresa",disabled:!!d})]}),e.jsxs("div",{style:r.formGroup,children:[e.jsx("label",{style:r.label,children:"NIT/CI *"}),e.jsx("input",{type:"text",value:o.nit_ci,onChange:t=>a({...o,nit_ci:t.target.value}),style:r.input,placeholder:"NIT o Carnet",disabled:!!d})]})]}),e.jsxs("div",{style:r.formRow,children:[e.jsxs("div",{style:r.formGroup,children:[e.jsx("label",{style:r.label,children:"Teléfono"}),e.jsx("input",{type:"tel",value:o.telefono,onChange:t=>a({...o,telefono:t.target.value}),style:r.input,placeholder:"Teléfono fijo"})]}),e.jsxs("div",{style:r.formGroup,children:[e.jsx("label",{style:r.label,children:"Celular"}),e.jsx("input",{type:"tel",value:o.celular,onChange:t=>a({...o,celular:t.target.value}),style:r.input,placeholder:"Celular de contacto"})]})]}),e.jsxs("div",{style:r.formRow,children:[e.jsxs("div",{style:r.formGroup,children:[e.jsx("label",{style:r.label,children:"Email"}),e.jsx("input",{type:"email",value:o.email,onChange:t=>a({...o,email:t.target.value}),style:r.input,placeholder:"correo@empresa.com"})]}),e.jsxs("div",{style:r.formGroup,children:[e.jsx("label",{style:r.label,children:"Nombre de Contacto"}),e.jsx("input",{type:"text",value:o.nombre_contacto,onChange:t=>a({...o,nombre_contacto:t.target.value}),style:r.input,placeholder:"Nombre del contacto"})]})]}),e.jsxs("div",{style:r.formRow,children:[e.jsxs("div",{style:{...r.formGroup,flex:2},children:[e.jsx("label",{style:r.label,children:"Dirección"}),e.jsx("input",{type:"text",value:o.direccion,onChange:t=>a({...o,direccion:t.target.value}),style:r.input,placeholder:"Dirección del proveedor"})]}),e.jsxs("div",{style:{...r.formGroup,flex:1},children:[e.jsx("label",{style:r.label,children:"Plazo Crédito (días)"}),e.jsx("input",{type:"number",value:o.plazo_credito,onChange:t=>a({...o,plazo_credito:t.target.value}),style:r.input,min:"0"})]})]})]}),e.jsxs("div",{style:r.modalFooter,children:[e.jsx("button",{style:r.cancelButton,onClick:()=>s(!1),disabled:h,children:"Cancelar"}),e.jsx("button",{style:r.saveButton,onClick:d?k:B,disabled:h,children:h?e.jsxs(e.Fragment,{children:[e.jsx(C,{size:16,style:{animation:"spin 1s linear infinite"}})," Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{size:16})," ",d?"Actualizar":"Crear"]})})]})]})}),e.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]})}const r={container:{padding:"20px",maxWidth:"1400px",margin:"0 auto"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"25px",flexWrap:"wrap",gap:"15px"},title:{margin:0,fontSize:"28px",fontWeight:"700",color:"#1a5d1a",display:"flex",alignItems:"center"},subtitle:{margin:"8px 0 0 0",color:"#6c757d",fontSize:"14px"},primaryButton:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 20px",background:"linear-gradient(135deg, #1a5d1a, #2e8b57)",color:"white",border:"none",borderRadius:"10px",fontSize:"14px",fontWeight:"600",cursor:"pointer",boxShadow:"0 4px 12px rgba(26, 93, 26, 0.3)"},toolbar:{display:"flex",gap:"12px",marginBottom:"20px",flexWrap:"wrap"},searchBox:{display:"flex",alignItems:"center",gap:"10px",padding:"10px 15px",background:"white",border:"1px solid #e9ecef",borderRadius:"10px",flex:1,maxWidth:"400px"},searchInput:{border:"none",outline:"none",fontSize:"14px",width:"100%",background:"transparent"},clearButton:{background:"none",border:"none",cursor:"pointer",color:"#999",padding:"2px"},tableContainer:{background:"white",borderRadius:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.05)",overflow:"auto"},table:{width:"100%",borderCollapse:"collapse",minWidth:"800px"},th:{padding:"15px 20px",textAlign:"left",background:"#f8f9fa",color:"#1a5d1a",fontWeight:"600",fontSize:"14px",borderBottom:"2px solid #e9ecef",whiteSpace:"nowrap"},tr:{borderBottom:"1px solid #e9ecef"},td:{padding:"15px 20px",fontSize:"14px",color:"#495057"},actionButtons:{display:"flex",gap:"8px",justifyContent:"center"},editButton:{padding:"8px",background:"#e3f2fd",border:"none",borderRadius:"8px",cursor:"pointer",color:"#1976d2"},deleteButton:{padding:"8px",background:"#ffebee",border:"none",borderRadius:"8px",cursor:"pointer",color:"#d32f2f"},loadingState:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"60px 20px",color:"#6c757d",gap:"15px"},emptyState:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"60px 20px",color:"#6c757d",gap:"15px"},modalOverlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"20px"},modal:{background:"white",borderRadius:"16px",width:"100%",maxWidth:"700px",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.3)",overflow:"hidden",maxHeight:"90vh",overflowY:"auto"},modalHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 25px",borderBottom:"1px solid #e9ecef",background:"linear-gradient(135deg, #f8f9fa, #e8f5e9)"},modalTitle:{margin:0,fontSize:"20px",fontWeight:"600",color:"#1a5d1a"},closeButton:{background:"none",border:"none",cursor:"pointer",color:"#6c757d",padding:"5px",borderRadius:"5px"},modalBody:{padding:"25px"},formRow:{display:"flex",gap:"15px",marginBottom:"15px",flexWrap:"wrap"},formGroup:{flex:1,minWidth:"200px"},label:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500",color:"#1a5d1a"},input:{width:"100%",padding:"12px 15px",border:"2px solid #e9ecef",borderRadius:"10px",fontSize:"14px",outline:"none",boxSizing:"border-box"},modalFooter:{display:"flex",justifyContent:"flex-end",gap:"12px",padding:"20px 25px",borderTop:"1px solid #e9ecef",background:"#f8f9fa"},cancelButton:{padding:"10px 20px",background:"white",border:"1px solid #e9ecef",borderRadius:"8px",fontSize:"14px",cursor:"pointer",color:"#6c757d"},saveButton:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 20px",background:"linear-gradient(135deg, #1a5d1a, #2e8b57)",color:"white",border:"none",borderRadius:"8px",fontSize:"14px",fontWeight:"500",cursor:"pointer"}};export{K as default};
