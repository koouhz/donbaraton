import{r as l,s as f,j as e,n as j,C as v,X as P,b as R,i as $}from"./index-hR7h3xft.js";import{F as H,L as A,n as d}from"./index-BTmhdvE4.js";import{D as F}from"./dollar-sign-DePuN86F.js";import{C as S}from"./credit-card--OOGtDUL.js";import{U as k}from"./upload-9HCD4CAy.js";import{F as J}from"./file-text-yG9jYhSI.js";import{S as Q}from"./save-CVL2Myj-.js";import{C as X}from"./clock-B7rEP_ha.js";function se(){const[c,C]=l.useState([]),[D,_]=l.useState(!0),[B,z]=l.useState(!1),[i,w]=l.useState(null),[m,u]=l.useState(!1),[x,h]=l.useState(null),[q,y]=l.useState(!1),[a,p]=l.useState({monto_pago:"",fecha_pago:new Date().toISOString().split("T")[0],metodo_pago:"TRANSFERENCIA",observaciones:""}),T=()=>{try{const t=localStorage.getItem("userData");if(t)return JSON.parse(t).username||"admin"}catch{}return"admin"};l.useEffect(()=>{I()},[]);const I=async()=>{_(!0);try{const{data:t,error:r}=await f.rpc("fn_leer_cuentas_por_pagar");if(r)throw r;const s=(t||[]).map(n=>({id:n.id,factura_nro:n.factura_nro,fecha_vencimiento:n.fecha_vencimiento,monto_total:n.monto_total,saldo_pendiente:n.saldo_pendiente,estado:n.estado,proveedores:{razon_social:n.proveedor}}));C(s)}catch(t){console.error("Error:",t),C([])}finally{_(!1)}},N=t=>{w(t),p({monto_pago:t.saldo_pendiente,fecha_pago:new Date().toISOString().split("T")[0],metodo_pago:"TRANSFERENCIA",observaciones:""}),z(!0)},b=()=>{z(!1),w(null),h(null),p({monto_pago:"",fecha_pago:new Date().toISOString().split("T")[0],metodo_pago:"TRANSFERENCIA",observaciones:""})},G=async t=>{if(!t)return null;const r=t.name.split(".").pop(),n=`comprobantes/${`comprobante_${i.id}_${Date.now()}.${r}`}`,{error:E}=await f.storage.from("pagos").upload(n,t);if(E)throw console.error("Error subiendo archivo:",E),new Error("Error al subir el comprobante");const{data:{publicUrl:V}}=f.storage.from("pagos").getPublicUrl(n);return V},L=async()=>{if(!a.monto_pago||parseFloat(a.monto_pago)<=0){d.error("Ingrese un monto válido");return}if(parseFloat(a.monto_pago)>parseFloat(i.saldo_pendiente)){d.error("El monto no puede ser mayor al saldo pendiente");return}if(!a.fecha_pago){d.error("Seleccione una fecha de pago");return}u(!0);try{let t=null;if(x){y(!0);try{t=await G(x)}catch{d.error("Error al subir el comprobante"),u(!1),y(!1);return}y(!1)}const{data:r,error:s}=await f.rpc("fn_registrar_pago_cuenta",{p_id_cuenta:i.id,p_monto_pago:parseFloat(a.monto_pago),p_fecha_pago:a.fecha_pago,p_metodo_pago:a.metodo_pago,p_observaciones:a.observaciones||null,p_username:T(),p_comprobante_url:t});s?(console.error("Error:",s),d.error(s.message||"Error al registrar el pago")):(d.success(`Pago ${r} registrado exitosamente`),b(),I())}catch(t){console.error("Error:",t),d.error("Error al procesar el pago")}finally{u(!1)}},g=t=>`Bs ${parseFloat(t||0).toFixed(2)}`,O=t=>new Date(t).toLocaleDateString("es-BO"),W=(t,r)=>{if(t==="PAGADO")return{bg:"#e8f5e9",color:"#2e7d32",icon:e.jsx($,{size:14})};const s=Math.ceil((new Date(r)-new Date)/(1e3*60*60*24));return s<0?{bg:"#ffebee",color:"#c62828",icon:e.jsx(v,{size:14})}:s<=7?{bg:"#fff3e0",color:"#e65100",icon:e.jsx(X,{size:14})}:{bg:"#e3f2fd",color:"#1565c0",icon:e.jsx(R,{size:14})}},M=c.filter(t=>t.estado!=="PAGADA").reduce((t,r)=>t+parseFloat(r.saldo_pendiente||0),0),U=c.filter(t=>t.estado!=="PAGADA"&&new Date(t.fecha_vencimiento)<new Date).length;return e.jsxs("div",{style:o.container,children:[e.jsx(H,{position:"top-right"}),e.jsx("header",{style:o.header,children:e.jsxs("div",{children:[e.jsxs("h1",{style:o.title,children:[e.jsx(j,{size:28,style:{marginRight:"12px"}}),"Cuentas por Pagar"]}),e.jsx("p",{style:o.subtitle,children:"Gestión de deudas con proveedores"})]})}),e.jsxs("div",{style:o.summaryCards,children:[e.jsxs("div",{style:o.summaryCard,children:[e.jsx(F,{size:28,style:{color:"#c62828"}}),e.jsxs("div",{children:[e.jsx("span",{style:{...o.summaryValue,color:"#c62828"},children:g(M)}),e.jsx("span",{style:o.summaryLabel,children:"Total Pendiente"})]})]}),e.jsxs("div",{style:o.summaryCard,children:[e.jsx(j,{size:28,style:{color:"#1a5d1a"}}),e.jsxs("div",{children:[e.jsx("span",{style:o.summaryValue,children:c.length}),e.jsx("span",{style:o.summaryLabel,children:"Total Cuentas"})]})]}),e.jsxs("div",{style:o.summaryCard,children:[e.jsx(v,{size:28,style:{color:"#e65100"}}),e.jsxs("div",{children:[e.jsx("span",{style:{...o.summaryValue,color:"#e65100"},children:U}),e.jsx("span",{style:o.summaryLabel,children:"Vencidas"})]})]})]}),e.jsxs("div",{style:o.infoCard,children:[e.jsx(v,{size:18}),e.jsx("p",{children:"Las cuentas por pagar se generan automáticamente al recepcionar órdenes de compra."})]}),e.jsx("div",{style:o.tableContainer,children:D?e.jsx("div",{style:o.loadingState,children:e.jsx(A,{size:40,style:{animation:"spin 1s linear infinite",color:"#1a5d1a"}})}):c.length===0?e.jsxs("div",{style:o.emptyState,children:[e.jsx(j,{size:48,style:{color:"#ccc"}}),e.jsx("p",{children:"No hay cuentas por pagar"})]}):e.jsxs("table",{style:o.table,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:o.th,children:"Proveedor"}),e.jsx("th",{style:o.th,children:"Factura"}),e.jsx("th",{style:o.th,children:"Vencimiento"}),e.jsx("th",{style:o.th,children:"Monto Total"}),e.jsx("th",{style:o.th,children:"Saldo Pendiente"}),e.jsx("th",{style:o.th,children:"Estado"}),e.jsx("th",{style:o.th,children:"Acciones"})]})}),e.jsx("tbody",{children:c.map((t,r)=>{const s=W(t.estado,t.fecha_vencimiento);return e.jsxs("tr",{style:o.tr,children:[e.jsx("td",{style:o.td,children:e.jsx("strong",{children:t.proveedores?.razon_social||"N/A"})}),e.jsx("td",{style:o.td,children:t.factura_nro||"-"}),e.jsx("td",{style:o.td,children:O(t.fecha_vencimiento)}),e.jsx("td",{style:o.td,children:g(t.monto_total)}),e.jsx("td",{style:{...o.td,fontWeight:"700",color:t.saldo_pendiente>0?"#c62828":"#2e7d32"},children:g(t.saldo_pendiente)}),e.jsx("td",{style:o.td,children:e.jsxs("span",{style:{...o.badge,background:s.bg,color:s.color},children:[s.icon,t.estado]})}),e.jsx("td",{style:o.td,children:t.estado!=="PAGADO"&&e.jsxs("button",{style:o.btnPagar,onClick:()=>N(t),title:"Registrar pago",children:[e.jsx(S,{size:16}),"Pagar"]})})]},t.id||r)})})]})}),B&&i&&e.jsx("div",{style:o.modalOverlay,children:e.jsxs("div",{style:o.modal,children:[e.jsxs("div",{style:o.modalHeader,children:[e.jsxs("h2",{style:o.modalTitle,children:[e.jsx(S,{size:22,style:{marginRight:"10px"}}),"Registrar Pago"]}),e.jsx("button",{style:o.btnClose,onClick:b,children:e.jsx(P,{size:20})})]}),e.jsxs("div",{style:o.modalBody,children:[e.jsxs("div",{style:o.cuentaInfo,children:[e.jsxs("div",{style:o.cuentaInfoRow,children:[e.jsx("span",{style:o.cuentaInfoLabel,children:"Proveedor:"}),e.jsx("strong",{children:i.proveedores?.razon_social})]}),e.jsxs("div",{style:o.cuentaInfoRow,children:[e.jsx("span",{style:o.cuentaInfoLabel,children:"Factura:"}),e.jsx("strong",{children:i.factura_nro})]}),e.jsxs("div",{style:o.cuentaInfoRow,children:[e.jsx("span",{style:o.cuentaInfoLabel,children:"Saldo Pendiente:"}),e.jsx("strong",{style:{color:"#c62828",fontSize:"18px"},children:g(i.saldo_pendiente)})]})]}),e.jsxs("div",{style:o.formGroup,children:[e.jsxs("label",{style:o.label,children:[e.jsx(F,{size:16}),"Monto a Pagar *"]}),e.jsx("input",{type:"number",style:o.input,placeholder:"Ej: 500.00",min:"0",max:i.saldo_pendiente,step:"0.01",value:a.monto_pago,onChange:t=>p({...a,monto_pago:t.target.value})}),e.jsxs("span",{style:{fontSize:"12px",color:"#6c757d",marginTop:"4px",display:"block"},children:["Máximo: ",g(i.saldo_pendiente)]})]}),e.jsxs("div",{style:o.formGroup,children:[e.jsxs("label",{style:o.label,children:[e.jsx(R,{size:16}),"Fecha de Pago *"]}),e.jsx("input",{type:"date",style:o.input,value:a.fecha_pago,onChange:t=>p({...a,fecha_pago:t.target.value})})]}),e.jsxs("div",{style:o.formGroup,children:[e.jsxs("label",{style:o.label,children:[e.jsx(S,{size:16}),"Método de Pago *"]}),e.jsxs("select",{style:o.select,value:a.metodo_pago,onChange:t=>p({...a,metodo_pago:t.target.value}),children:[e.jsx("option",{value:"EFECTIVO",children:"EFECTIVO"}),e.jsx("option",{value:"TRANSFERENCIA",children:"TRANSFERENCIA BANCARIA"}),e.jsx("option",{value:"CHEQUE",children:"CHEQUE"})]})]}),e.jsxs("div",{style:o.formGroup,children:[e.jsx("label",{style:o.label,children:"Observaciones"}),e.jsx("textarea",{style:o.textarea,placeholder:"Detalles adicionales del pago...",rows:3,value:a.observaciones,onChange:t=>p({...a,observaciones:t.target.value})})]}),e.jsxs("div",{style:o.formGroup,children:[e.jsxs("label",{style:o.label,children:[e.jsx(k,{size:16}),"Adjuntar Comprobante"]}),e.jsxs("div",{style:o.uploadContainer,children:[e.jsx("input",{type:"file",id:"comprobante-file",accept:"image/*,.pdf",style:{display:"none"},onChange:t=>h(t.target.files[0])}),e.jsxs("label",{htmlFor:"comprobante-file",style:o.uploadButton,children:[e.jsx(k,{size:18}),x?"Cambiar archivo":"Seleccionar archivo"]}),x&&e.jsxs("div",{style:o.fileInfo,children:[e.jsx(J,{size:16}),e.jsx("span",{style:o.fileName,children:x.name}),e.jsx("button",{style:o.removeFileBtn,onClick:()=>h(null),type:"button",children:e.jsx(P,{size:14})})]})]}),e.jsx("span",{style:{fontSize:"11px",color:"#6c757d",marginTop:"4px",display:"block"},children:"Formatos: JPG, PNG, PDF (máx. 5MB)"})]})]}),e.jsxs("div",{style:o.modalFooter,children:[e.jsx("button",{style:o.btnSecondary,onClick:b,children:"Cancelar"}),e.jsxs("button",{style:o.btnPrimary,onClick:L,disabled:m,children:[m?e.jsx(A,{size:16,style:{animation:"spin 1s linear infinite"}}):e.jsx(Q,{size:16}),m?"Guardando...":"Confirmar Pago"]})]})]})}),e.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]})}const o={container:{padding:"20px",maxWidth:"1200px",margin:"0 auto"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},title:{margin:0,fontSize:"28px",fontWeight:"700",color:"#1a5d1a",display:"flex",alignItems:"center"},subtitle:{margin:"8px 0 0 0",color:"#6c757d",fontSize:"14px"},summaryCards:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:"15px",marginBottom:"20px"},summaryCard:{display:"flex",alignItems:"center",gap:"15px",padding:"20px",background:"white",borderRadius:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.05)"},summaryValue:{display:"block",fontSize:"24px",fontWeight:"700",color:"#1a5d1a"},summaryLabel:{fontSize:"13px",color:"#6c757d"},infoCard:{display:"flex",alignItems:"center",gap:"12px",padding:"15px 20px",background:"#e3f2fd",borderRadius:"10px",marginBottom:"20px",color:"#1565c0",fontSize:"14px"},tableContainer:{background:"white",borderRadius:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.05)",overflow:"auto"},table:{width:"100%",borderCollapse:"collapse",minWidth:"900px"},th:{padding:"15px 20px",textAlign:"left",background:"#f8f9fa",color:"#1a5d1a",fontWeight:"600",fontSize:"14px",borderBottom:"2px solid #e9ecef"},tr:{borderBottom:"1px solid #e9ecef"},td:{padding:"15px 20px",fontSize:"14px",color:"#495057"},badge:{display:"inline-flex",alignItems:"center",gap:"5px",padding:"5px 12px",borderRadius:"20px",fontSize:"12px",fontWeight:"600"},btnPagar:{display:"flex",alignItems:"center",gap:"6px",padding:"8px 16px",background:"linear-gradient(135deg, #1a5d1a, #2e7d32)",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"13px",fontWeight:"500"},loadingState:{display:"flex",justifyContent:"center",padding:"60px"},emptyState:{display:"flex",flexDirection:"column",alignItems:"center",padding:"60px",color:"#6c757d",gap:"15px"},modalOverlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3},modal:{background:"white",borderRadius:"16px",width:"90%",maxWidth:"550px",maxHeight:"90vh",overflow:"auto",boxShadow:"0 20px 50px rgba(0,0,0,0.2)"},modalHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 25px",borderBottom:"1px solid #e9ecef"},modalTitle:{margin:0,fontSize:"20px",fontWeight:"600",color:"#1a5d1a",display:"flex",alignItems:"center"},modalBody:{padding:"25px"},modalFooter:{display:"flex",justifyContent:"flex-end",gap:"12px",padding:"20px 25px",borderTop:"1px solid #e9ecef",background:"#f8f9fa"},btnClose:{background:"transparent",border:"none",cursor:"pointer",color:"#999",padding:"5px"},btnPrimary:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 20px",background:"linear-gradient(135deg, #1a5d1a, #2e7d32)",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600",fontSize:"14px"},btnSecondary:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 20px",background:"#f5f5f5",color:"#333",border:"1px solid #ddd",borderRadius:"8px",cursor:"pointer",fontWeight:"500"},cuentaInfo:{padding:"20px",background:"#f8f9fa",borderRadius:"10px",marginBottom:"20px",border:"1px solid #e9ecef"},cuentaInfoRow:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},cuentaInfoLabel:{fontSize:"14px",color:"#6c757d"},formGroup:{marginBottom:"20px"},label:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px",fontWeight:"500",color:"#333",fontSize:"14px"},input:{width:"100%",padding:"12px 15px",border:"1px solid #ddd",borderRadius:"8px",fontSize:"14px",boxSizing:"border-box"},select:{width:"100%",padding:"12px 15px",border:"1px solid #ddd",borderRadius:"8px",fontSize:"14px",boxSizing:"border-box",background:"white"},textarea:{width:"100%",padding:"12px 15px",border:"1px solid #ddd",borderRadius:"8px",fontSize:"14px",boxSizing:"border-box",resize:"vertical"},uploadContainer:{display:"flex",flexDirection:"column",gap:"10px"},uploadButton:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"12px 20px",background:"#f0f0f0",border:"2px dashed #ccc",borderRadius:"8px",cursor:"pointer",fontSize:"14px",color:"#666",transition:"all 0.2s"},fileInfo:{display:"flex",alignItems:"center",gap:"10px",padding:"10px 15px",background:"#e8f5e9",borderRadius:"8px",color:"#2e7d32"},fileName:{flex:1,fontSize:"13px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},removeFileBtn:{display:"flex",alignItems:"center",justifyContent:"center",padding:"4px",background:"#ffebee",border:"none",borderRadius:"50%",cursor:"pointer",color:"#c62828"}};export{se as default};
