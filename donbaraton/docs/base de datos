-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.alertas_stock (
  id_alerta character varying NOT NULL,
  id_producto character varying,
  id_lote character varying,
  tipo character varying CHECK (tipo::text = ANY (ARRAY['STOCK_MINIMO'::character varying, 'VENCIMIENTO'::character varying, 'STOCK_CRITICO'::character varying]::text[])),
  mensaje text,
  fecha_generada timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  fecha_resuelta timestamp without time zone,
  estado character varying DEFAULT 'PENDIENTE'::character varying CHECK (estado::text = ANY (ARRAY['PENDIENTE'::character varying, 'RESUELTA'::character varying, 'DESCARTADA'::character varying]::text[])),
  CONSTRAINT alertas_stock_pkey PRIMARY KEY (id_alerta),
  CONSTRAINT alertas_stock_id_producto_fkey FOREIGN KEY (id_producto) REFERENCES public.productos(id_producto),
  CONSTRAINT alertas_stock_id_lote_fkey FOREIGN KEY (id_lote) REFERENCES public.lotes(id_lote)
);
CREATE TABLE public.asistencias (
  id_asistencia character varying NOT NULL,
  id_empleado character varying,
  fecha date NOT NULL,
  hora_entrada time without time zone,
  hora_salida time without time zone,
  tipo character varying CHECK (tipo::text = ANY (ARRAY['ENTRADA'::character varying, 'SALIDA'::character varying, 'RETRASO'::character varying]::text[])),
  metodo character varying DEFAULT 'MANUAL'::character varying CHECK (metodo::text = ANY (ARRAY['MANUAL'::character varying, 'TARJETA'::character varying]::text[])),
  observaciones character varying,
  CONSTRAINT asistencias_pkey PRIMARY KEY (id_asistencia),
  CONSTRAINT asistencias_id_empleado_fkey FOREIGN KEY (id_empleado) REFERENCES public.empleados(id_empleado)
);
CREATE TABLE public.auditoria (
  id_auditoria character varying NOT NULL,
  fecha_hora timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  usuario character varying NOT NULL,
  modulo character varying,
  accion character varying,
  tabla_afectada character varying,
  id_registro_afectado character varying,
  valores_anteriores jsonb,
  valores_nuevos jsonb,
  detalles text,
  ip_origen character varying,
  estado character varying DEFAULT 'EXITOSO'::character varying CHECK (estado::text = ANY (ARRAY['EXITOSO'::character varying, 'FALLIDO'::character varying]::text[])),
  CONSTRAINT auditoria_pkey PRIMARY KEY (id_auditoria)
);
CREATE TABLE public.cajeros (
  id_cajero character varying NOT NULL,
  id_usuario character varying NOT NULL,
  estado character varying DEFAULT 'ACTIVO'::character varying,
  fecha_registro timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT cajeros_pkey PRIMARY KEY (id_cajero),
  CONSTRAINT cajeros_id_usuario_fkey FOREIGN KEY (id_usuario) REFERENCES public.usuarios(id_usuario)
);
CREATE TABLE public.cargos (
  id_cargo character varying NOT NULL,
  nombre character varying NOT NULL,
  descripcion text,
  fecha_registro timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT cargos_pkey PRIMARY KEY (id_cargo)
);
CREATE TABLE public.categorias (
  id_categoria character varying NOT NULL,
  nombre character varying NOT NULL,
  descripcion text,
  estado character varying DEFAULT 'ACTIVO'::character varying CHECK (estado::text = ANY (ARRAY['ACTIVO'::character varying, 'INACTIVO'::character varying]::text[])),
  fecha_registro timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT categorias_pkey PRIMARY KEY (id_categoria)
);
CREATE TABLE public.cierre_caja (
  id_cierre character varying NOT NULL,
  id_usuario character varying,
  fecha date NOT NULL,
  hora_cierre time without time zone,
  total_efectivo numeric,
  diferencia numeric,
  observaciones character varying,
  firma_supervisor character varying,
  CONSTRAINT cierre_caja_pkey PRIMARY KEY (id_cierre),
  CONSTRAINT cierre_caja_id_usuario_fkey FOREIGN KEY (id_usuario) REFERENCES public.usuarios(id_usuario)
);
CREATE TABLE public.cierre_caja_detalle (
  id_detalle character varying NOT NULL,
  id_cierre character varying,
  denominacion numeric,
  cantidad integer,
  CONSTRAINT cierre_caja_detalle_pkey PRIMARY KEY (id_detalle),
  CONSTRAINT cierre_caja_detalle_id_cierre_fkey FOREIGN KEY (id_cierre) REFERENCES public.cierre_caja(id_cierre)
);
CREATE TABLE public.clientes (
  id_cliente character varying NOT NULL,
  nombres character varying NOT NULL,
  apellido_paterno character varying,
  apellido_materno character varying,
  ci_nit character varying NOT NULL UNIQUE,
  telefono character varying,
  email character varying,
  direccion text,
  estado character varying DEFAULT 'ACTIVO'::character varying CHECK (estado::text = ANY (ARRAY['ACTIVO'::character varying, 'INACTIVO'::character varying]::text[])),
  fecha_registro timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT clientes_pkey PRIMARY KEY (id_cliente)
);
CREATE TABLE public.cuentas_por_pagar (
  id_cuenta character varying NOT NULL,
  id_proveedor character varying,
  numero_factura character varying,
  fecha_emision date,
  fecha_vencimiento date,
  monto_total numeric,
  saldo_pendiente numeric,
  estado character varying DEFAULT 'PENDIENTE'::character varying CHECK (estado::text = ANY (ARRAY['PENDIENTE'::character varying, 'PAGADO'::character varying, 'VENCIDO'::character varying]::text[])),
  observaciones text,
  fecha_registro timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT cuentas_por_pagar_pkey PRIMARY KEY (id_cuenta),
  CONSTRAINT cuentas_por_pagar_id_proveedor_fkey FOREIGN KEY (id_proveedor) REFERENCES public.proveedores(id_proveedor)
);
CREATE TABLE public.detalle_orden_compra (
  id_detalle_orden character varying NOT NULL,
  id_orden character varying,
  id_producto character varying,
  cantidad integer NOT NULL CHECK (cantidad > 0),
  precio_unitario numeric,
  descuento numeric DEFAULT 0,
  subtotal numeric,
  CONSTRAINT detalle_orden_compra_pkey PRIMARY KEY (id_detalle_orden),
  CONSTRAINT detalle_orden_compra_id_orden_fkey FOREIGN KEY (id_orden) REFERENCES public.ordenes_compra(id_orden),
  CONSTRAINT detalle_orden_compra_id_producto_fkey FOREIGN KEY (id_producto) REFERENCES public.productos(id_producto)
);
CREATE TABLE public.detalle_ventas (
  id_detalle_venta character varying NOT NULL,
  id_venta character varying,
  id_producto character varying,
  cantidad integer NOT NULL CHECK (cantidad > 0),
  precio_unitario numeric,
  descuento numeric DEFAULT 0,
  subtotal numeric,
  CONSTRAINT detalle_ventas_pkey PRIMARY KEY (id_detalle_venta),
  CONSTRAINT detalle_ventas_id_venta_fkey FOREIGN KEY (id_venta) REFERENCES public.ventas(id_venta),
  CONSTRAINT detalle_ventas_id_producto_fkey FOREIGN KEY (id_producto) REFERENCES public.productos(id_producto)
);
CREATE TABLE public.devoluciones_proveedor (
  id_devolucion character varying NOT NULL,
  id_recepcion character varying,
  motivo character varying CHECK (motivo::text = ANY (ARRAY['DAÑO'::character varying, 'VENCIDO'::character varying, 'SOBRANTE'::character varying, 'OTRO'::character varying]::text[])),
  cantidad integer NOT NULL CHECK (cantidad > 0),
  observaciones text,
  fecha timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT devoluciones_proveedor_pkey PRIMARY KEY (id_devolucion),
  CONSTRAINT devoluciones_proveedor_id_recepcion_fkey FOREIGN KEY (id_recepcion) REFERENCES public.recepciones(id_recepcion)
);
CREATE TABLE public.devoluciones_ventas (
  id_devolucion_venta character varying NOT NULL,
  id_venta character varying,
  motivo character varying,
  forma_reembolso character varying CHECK (forma_reembolso::text = ANY (ARRAY['EFECTIVO'::character varying, 'NOTA_CREDITO'::character varying, 'TARJETA'::character varying]::text[])),
  fecha timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  id_usuario character varying,
  CONSTRAINT devoluciones_ventas_pkey PRIMARY KEY (id_devolucion_venta),
  CONSTRAINT devoluciones_ventas_id_venta_fkey FOREIGN KEY (id_venta) REFERENCES public.ventas(id_venta),
  CONSTRAINT devoluciones_ventas_id_usuario_fkey FOREIGN KEY (id_usuario) REFERENCES public.usuarios(id_usuario)
);
CREATE TABLE public.empleados (
  id_empleado character varying NOT NULL,
  ci character varying NOT NULL UNIQUE,
  expedido character varying,
  nombres character varying NOT NULL,
  apellido_paterno character varying,
  apellido_materno character varying,
  fecha_nacimiento date,
  sexo character varying CHECK (sexo::text = ANY (ARRAY['M'::character varying, 'F'::character varying]::text[])),
  telefono character varying,
  celular character varying,
  email character varying,
  direccion text,
  id_cargo character varying,
  fecha_contratacion date,
  tipo_contrato character varying,
  id_horario character varying,
  salario numeric,
  estado character varying DEFAULT 'ACTIVO'::character varying CHECK (estado::text = ANY (ARRAY['ACTIVO'::character varying, 'INACTIVO'::character varying]::text[])),
  foto_url text,
  fecha_registro timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  id_usuario character varying,
  CONSTRAINT empleados_pkey PRIMARY KEY (id_empleado),
  CONSTRAINT empleados_id_cargo_fkey FOREIGN KEY (id_cargo) REFERENCES public.cargos(id_cargo),
  CONSTRAINT empleados_id_horario_fkey FOREIGN KEY (id_horario) REFERENCES public.horarios(id_horario),
  CONSTRAINT empleados_id_usuario_fkey FOREIGN KEY (id_usuario) REFERENCES public.usuarios(id_usuario)
);
CREATE TABLE public.horarios (
  id_horario character varying NOT NULL,
  nombre character varying,
  hora_entrada time without time zone,
  hora_salida time without time zone,
  fecha_registro timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT horarios_pkey PRIMARY KEY (id_horario)
);
CREATE TABLE public.lotes (
  id_lote character varying NOT NULL,
  id_producto character varying,
  lote character varying NOT NULL,
  fecha_vencimiento date NOT NULL,
  cantidad integer NOT NULL CHECK (cantidad >= 0),
  estado character varying DEFAULT 'ACTIVO'::character varying CHECK (estado::text = ANY (ARRAY['ACTIVO'::character varying, 'VENCIDO'::character varying, 'AGOTADO'::character varying]::text[])),
  CONSTRAINT lotes_pkey PRIMARY KEY (id_lote),
  CONSTRAINT lotes_id_producto_fkey FOREIGN KEY (id_producto) REFERENCES public.productos(id_producto)
);
CREATE TABLE public.movimientos_inventario (
  id_movimiento character varying NOT NULL,
  id_producto character varying,
  tipo character varying CHECK (tipo::text = ANY (ARRAY['ENTRADA'::character varying, 'SALIDA'::character varying, 'AJUSTE+'::character varying, 'AJUSTE-'::character varying, 'MERMA'::character varying, 'DAÑO'::character varying, 'ROBO'::character varying]::text[])),
  cantidad numeric NOT NULL CHECK (cantidad >= 0::numeric),
  lote character varying,
  fecha_vencimiento date,
  documento character varying,
  motivo character varying,
  observaciones text,
  id_usuario character varying,
  fecha_hora timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT movimientos_inventario_pkey PRIMARY KEY (id_movimiento),
  CONSTRAINT movimientos_inventario_id_producto_fkey FOREIGN KEY (id_producto) REFERENCES public.productos(id_producto),
  CONSTRAINT movimientos_inventario_id_usuario_fkey FOREIGN KEY (id_usuario) REFERENCES public.usuarios(id_usuario)
);
CREATE TABLE public.ordenes_compra (
  id_orden character varying NOT NULL,
  id_proveedor character varying,
  fecha_emision date NOT NULL,
  fecha_entrega date,
  total numeric,
  estado character varying DEFAULT 'PENDIENTE'::character varying CHECK (estado::text = ANY (ARRAY['PENDIENTE'::character varying, 'RECIBIDA'::character varying, 'CANCELADA'::character varying]::text[])),
  id_usuario character varying,
  fecha_registro timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT ordenes_compra_pkey PRIMARY KEY (id_orden),
  CONSTRAINT ordenes_compra_id_proveedor_fkey FOREIGN KEY (id_proveedor) REFERENCES public.proveedores(id_proveedor),
  CONSTRAINT ordenes_compra_id_usuario_fkey FOREIGN KEY (id_usuario) REFERENCES public.usuarios(id_usuario)
);
CREATE TABLE public.pagos (
  id_pago character varying NOT NULL,
  id_venta character varying,
  medio character varying CHECK (medio::text = ANY (ARRAY['EFECTIVO'::character varying, 'DEBITO'::character varying, 'CREDITO'::character varying, 'QR'::character varying, 'TRANSFERENCIA'::character varying]::text[])),
  importe numeric NOT NULL,
  vuelto numeric DEFAULT 0,
  CONSTRAINT pagos_pkey PRIMARY KEY (id_pago),
  CONSTRAINT pagos_id_venta_fkey FOREIGN KEY (id_venta) REFERENCES public.ventas(id_venta)
);
CREATE TABLE public.producto_proveedor (
  id_producto character varying NOT NULL,
  id_proveedor character varying NOT NULL,
  precio_compra numeric,
  CONSTRAINT producto_proveedor_pkey PRIMARY KEY (id_producto, id_proveedor),
  CONSTRAINT producto_proveedor_id_producto_fkey FOREIGN KEY (id_producto) REFERENCES public.productos(id_producto),
  CONSTRAINT producto_proveedor_id_proveedor_fkey FOREIGN KEY (id_proveedor) REFERENCES public.proveedores(id_proveedor)
);
CREATE TABLE public.productos (
  id_producto character varying NOT NULL,
  codigo_interno character varying NOT NULL UNIQUE,
  codigo_barras character varying,
  nombre character varying NOT NULL,
  id_categoria character varying,
  marca character varying,
  precio_costo numeric,
  precio_venta numeric NOT NULL,
  stock_minimo integer DEFAULT 0,
  stock_maximo integer DEFAULT 0,
  stock_actual integer DEFAULT 0 CHECK (stock_actual >= 0),
  unidad_medida character varying,
  controla_vencimiento boolean DEFAULT false,
  foto_url text,
  motivo_desactivacion character varying,
  estado character varying DEFAULT 'ACTIVO'::character varying CHECK (estado::text = ANY (ARRAY['ACTIVO'::character varying, 'INACTIVO'::character varying]::text[])),
  fecha_registro timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT productos_pkey PRIMARY KEY (id_producto),
  CONSTRAINT productos_id_categoria_fkey FOREIGN KEY (id_categoria) REFERENCES public.categorias(id_categoria)
);
CREATE TABLE public.proveedores (
  id_proveedor character varying NOT NULL,
  razon_social character varying NOT NULL,
  nit_ci character varying NOT NULL UNIQUE,
  telefono character varying,
  celular_contacto character varying,
  email character varying,
  direccion text,
  nombre_contacto character varying,
  plazo_credito integer DEFAULT 0,
  estado character varying DEFAULT 'ACTIVO'::character varying CHECK (estado::text = ANY (ARRAY['ACTIVO'::character varying, 'INACTIVO'::character varying]::text[])),
  fecha_registro timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT proveedores_pkey PRIMARY KEY (id_proveedor)
);
CREATE TABLE public.recepciones (
  id_recepcion character varying NOT NULL,
  id_orden character varying,
  fecha_ingreso date NOT NULL,
  cantidad_recibida integer,
  lote character varying,
  fecha_vencimiento date,
  id_usuario character varying,
  fecha_registro timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT recepciones_pkey PRIMARY KEY (id_recepcion),
  CONSTRAINT recepciones_id_orden_fkey FOREIGN KEY (id_orden) REFERENCES public.ordenes_compra(id_orden),
  CONSTRAINT recepciones_id_usuario_fkey FOREIGN KEY (id_usuario) REFERENCES public.usuarios(id_usuario)
);
CREATE TABLE public.roles (
  id_rol character varying NOT NULL,
  nombre character varying NOT NULL,
  descripcion text,
  estado character varying DEFAULT 'ACTIVO'::character varying CHECK (estado::text = ANY (ARRAY['ACTIVO'::character varying, 'INACTIVO'::character varying]::text[])),
  fecha_registro timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT roles_pkey PRIMARY KEY (id_rol)
);
CREATE TABLE public.usuarios (
  id_usuario character varying NOT NULL,
  id_empleado character varying,
  username character varying NOT NULL UNIQUE,
  password_hash character varying NOT NULL,
  id_rol character varying,
  estado character varying DEFAULT 'ACTIVO'::character varying CHECK (estado::text = ANY (ARRAY['ACTIVO'::character varying, 'INACTIVO'::character varying]::text[])),
  fecha_registro timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT usuarios_pkey PRIMARY KEY (id_usuario),
  CONSTRAINT usuarios_id_empleado_fkey FOREIGN KEY (id_empleado) REFERENCES public.empleados(id_empleado),
  CONSTRAINT usuarios_id_rol_fkey FOREIGN KEY (id_rol) REFERENCES public.roles(id_rol)
);
CREATE TABLE public.ventas (
  id_venta character varying NOT NULL,
  id_cliente character varying,
  fecha_hora timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  total numeric NOT NULL,
  tipo_comprobante character varying CHECK (tipo_comprobante::text = ANY (ARRAY['TICKET'::character varying, 'FACTURA'::character varying, 'NOTA_CREDITO'::character varying]::text[])),
  nit_cliente character varying,
  razon_social character varying,
  direccion_factura text,
  numero_factura character varying,
  id_usuario character varying,
  estado character varying DEFAULT 'ACTIVO'::character varying CHECK (estado::text = ANY (ARRAY['ACTIVO'::character varying, 'ANULADO'::character varying]::text[])),
  id_cajero character varying,
  CONSTRAINT ventas_pkey PRIMARY KEY (id_venta),
  CONSTRAINT ventas_id_cliente_fkey FOREIGN KEY (id_cliente) REFERENCES public.clientes(id_cliente),
  CONSTRAINT ventas_id_usuario_fkey FOREIGN KEY (id_usuario) REFERENCES public.usuarios(id_usuario),
  CONSTRAINT ventas_id_cajero_fkey FOREIGN KEY (id_cajero) REFERENCES public.cajeros(id_cajero)
);