| --------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| fn_obtener_ultimo_lote            | CREATE OR REPLACE FUNCTION public.fn_obtener_ultimo_lote()
 RETURNS character varying
 LANGUAGE plpgsql
AS $function$
             UNIVERSIDAD PRIVADA DOMINGO SAVIO




Validaciones para el Sistema de Gestión del Supermercado "Don Baraton"



                             Versión: 1.0

                            Modificaciones:

                    Fecha: 12 de diciembre de 2025

                  Autores: Apaza Soria Daniela Yeslen
                       Bocangel La Torre Ignacio

                      Cruz Aguilar Gregory Ivan

                     Limachi Bonilla Jhoel Marvin

                     Torrez Valeriano Victor Edwin
Este documento complementa el análisis original del sistema integrado de gestión
comercial para el Supermercado "Don Baraton". Se enfoca en definir validaciones
específicas para los campos de datos en cada módulo funcional, con el objetivo
de asegurar la integridad, consistencia y usabilidad de la información. Las
validaciones se basan en los requerimientos funcionales y no funcionales
descritos en el documento original (e.g., NF-12 para transacciones atómicas, NF-
13 para validaciones estrictas como no permitir ventas con stock cero).

Se incluyen reglas comunes como:

   •   Campos de texto (nombres, apellidos): Solo letras (incluyendo acentos y ñ
       en español), espacios y guiones. No números ni símbolos especiales.

   •   Campos numéricos: Solo dígitos, positivos, con límites razonables.

   •   Fechas: Formato válido (e.g., DD/MM/YYYY), no futuras o pasadas según
       contexto.

   •   Correos: Formato estándar (user@domain.com).

   •   Teléfonos: Numéricos, longitud típica para Bolivia (8 dígitos).

   •   Códigos/NIT/CI: Formatos específicos para Bolivia (CI: 7-11 dígitos con
       posible extensión; NIT: 11 dígitos).

   •   Obligatoriedad: Campos requeridos no pueden estar vacíos.

   •   Longitudes: Límites para evitar entradas excesivas.

Las validaciones se agrupan por módulo, similar al documento original. Se
asumen validaciones adicionales basadas en mejores prácticas para sistemas de
gestión comercial.

11. Gestión de Productos (PROD-01 a PROD-06)

Estos son para registrar, editar y controlar productos. Evitan errores como nombres
raros o stock malo.

                                Cómo validar       Mensaje
Códig                Qué es /                                   Código sugerido (Regex
      Campo                        (Reglas        de error si
  o                  Por qué                                       o pseudocódigo)
                                   exactas)           falla
                               - Obligatorio. -   "El
                   Nombre del
                               Solo letras (A-    nombre
                   producto.
                               Z, a-z, áéíóúñ),   solo puede    Regex: ^[a-zA-
PRO                Para que
     Nombre                    espacios y         tener         ZáéíóúñÁÉÍÓÚÑ\s-]{3,1
D-01               sea legible
                               guiones (-). -     letras,       00}$
                   y no
                               No números ni      espacios o
                   confunda.
                               símbolos           guiones.
                              Cómo validar Mensaje
Códig              Qué es /                            Código sugerido (Regex
      Campo                     (Reglas    de error si
  o                Por qué                                o pseudocódigo)
                                exactas)      falla
                           (!@#). -             No
                           Longitud:            números
                           Mínimo 3,            ni
                           máximo 100           símbolos.
                           caracteres. -        Ejemplo:
                           Ejemplo bueno:       'Arroz
                           "Coca Cola           Blanco'."
                           Light". -
                           Ejemplo malo:
                           "Coca123" o
                           "Coca-Cola!".
                           - Obligatorio. -
                           Solo letras y
                           espacios. -
                           Seleccionar de
              Tipo de      lista fija (define   "Elige una
              producto     10-20                categoría
              (e.g.,       categorías en el     de la lista. Usar dropdown (lista
PRO Categoría
              "Perecedero sistema). -           No           desplegable) en la
D-01 o tipo
              "). Para     Longitud: 5-50       inventes interfaz.
              clasificar   caracteres. -        una
              fácil.       Ejemplo bueno:       nueva."
                           "Bebidas No
                           Alcohólicas". -
                           Ejemplo malo:
                           "Bebidas123".
                           - Obligatorio. -
                           Numérico
                           positivo con
                                                "El precio
                           hasta 2
                                                debe ser
              Precio de    decimales (e.g.,
                                                un número
              venta. Para 10.50). -                        Pseudocódigo: if (precio
PRO                                             positivo
     Precio   evitar       Rango: 0.01 a                   <= 0 or precio > 9999.99)
D-01                                            entre 0.01
              precios      9999.99. - No                   { error; }
                                                y 9999.99.
              locos.       negativo ni
                                                Ejemplo:
                           cero. - Ejemplo
                                                10.50."
                           bueno: 15.75. -
                           Ejemplo malo:
                           -5 o "quince".
                           - Obligatorio. -                   Regex: ^[a-zA-Z0-
              Código                            "El código
                           Alfanumérico                       9]{5,20}$ + chequeo en
              único (e.g.,                      debe tener
     Código                (letras y                          BD: SELECT
PRO           barcode).                         5-20
     del                   números). -                        COUNT(*) FROM
D-01          Para                              caracteres,
     producto              Longitud:                          productos WHERE
              identificar                       solo letras
                           Exacto 13                          codigo = nuevo_codigo;
              rápido.                           y números,
                           dígitos para                       if >0 { error; }
                              Cómo validar Mensaje
Códig             Qué es /                             Código sugerido (Regex
      Campo                     (Reglas    de error si
  o               Por qué                                 o pseudocódigo)
                                exactas)      falla
                              EAN-13, o 5-        y no
                              20 si               repetirse."
                              personalizado. -
                              Único en todo
                              el sistema. -
                              Ejemplo bueno:
                              "775123456789
                              0". - Ejemplo
                              malo: "ABC"
                              (corto) o
                              duplicado.
                              - Obligatorio. -
                              Seleccionar de
                              lista: kg, litro,
                                                  "Elige una
              Cómo se         unidad, caja,
                                                  unidad de
              mide (e.g.,     etc. - Solo
PRO Unidad de                                     la lista,
              "kg"). Para     letras. -                      Usar dropdown.
D-01 medida                                       como 'kg'
              consistencia    Longitud: 1-10.
                                                  o
              .               - Ejemplo
                                                  'unidad'."
                              bueno: "kg". -
                              Ejemplo malo:
                              "123kg".
                              - Opcional. -
                              Letras,
                              números,
                                                  "La
                              espacios y
                                                  presentaci
               Descripción    símbolos
                                                  ón debe
               extra (e.g.,   básicos (., -). -
PRO Presentaci                                    ser corta,
               "Botella       Longitud: 1-50.                 Regex: ^[\w\s.-]{1,50}$
D-01 ón                                           máximo
               2L").          - Ejemplo
                                                  50
               Opcional.      bueno:
                                                  caracteres.
                              "Paquete de 6".
                                                  "
                              - Ejemplo
                              malo: Texto de
                              200 letras.
                              - No editar
                              código. -           "No
                                                                Pseudocódigo: if
                              Validar como        puedes
               Cambiar                                          (nuevo_nombre invalid)
                              en registro. -      cambiar el
PRO Edición de datos. Para                                      { usa misma validación
                              Registrar quién     código.
D-02 productos actualizar                                       que PROD-01; } +
                              cambió              Corrige
               sin errores.                                     INSERT INTO auditoria
                              (auditoría). -      otros
                                                                (usuario, cambio);
                              No permitir si      campos."
                              stock en uso.
                             Cómo validar Mensaje
Códig                Qué es /                               Código sugerido (Regex
      Campo                      (Reglas      de error si
  o                  Por qué                                   o pseudocódigo)
                                exactas)          falla
                                              "No
                            - Confirmar con puedes
                Desactivar botón "Sí/No". desactivar
                                                            Pseudocódigo: if (stock >
                producto.   - No si stock > si hay
PRO Eliminaci                                               0) { error; } else
                Para no     0 o ventas        stock o
D-03 ón lógica                                              { UPDATE productos
                borrar      pendientes. -     ventas
                                                            SET activo=0; }
                historia.   Cambiar estado abiertas.
                            a "inactivo".     Vende
                                              primero."
                            - Numérico
                            entero >=0. -
                Cantidad en                   "Stock no     Automático: stock =
PRO Stock                   No editable
                almacén.                      puede ser     stock - vendido; if <0
D-04 disponible             manual salvo
                Automático.                   negativo."    { error; }
                            ajustes. - Alerta
                            si < mínimo.
                            - Entero          "Stock
PRO Stock       Nivel para positivo 1-        mínimo        Pseudocódigo: if
D-04 mínimo     alerta.     9999. -           debe ser al   (minimo <1) { error; }
                            Obligatorio.      menos 1."
                            - Formato
                            DD/MM/YYY
                                              "La fecha
                Fecha       Y. - No pasada
     Fecha de                                 debe ser
                caducidad. para nuevos. -
PRO vencimien                                 futura.       Usar date picker; if
                Para        Alerta si <30
D-06 to (por                                  Ejemplo:      (fecha < hoy) { error; }
                perecederos días. -
     lote)                                    31/12/202
                .           Obligatorio
                                              6."
                            para categorías
                            perecederas.


2. Compras / Proveedores (COMP-01 a COMP-05)
Para proveedores y compras. Evita NIT falsos o compras sin stock.

Códig               Qué es /      Cómo      Mensaje de
         Campo                                                 Código sugerido
  o                 Por qué      validar      error
                              -
                   Número Obligatorio.      "NIT debe
                   fiscal     - Exacto 11   tener 11
                   proveedor dígitos. -     números
COMP                                                    Regex: ^\d{11}$ + función
     NIT           .          Solo          exactos.
-01                                                     chequeo NIT.
                   Obligatori números. -    Ejemplo:
                   o en       Verificar     12345678901
                   Bolivia. dígito          ."
                              control
Códig              Qué es /     Cómo        Mensaje de
        Campo                                                  Código sugerido
  o                Por qué     validar        error
                          (fórmula
                          boliviana
                          simple). -
                          Ejemplo
                          bueno:
                          1234567890
                          1. - Ejemplo
                          malo: 123
                          (corto).
                          -
                          Obligatorio.
                          - Solo letras,
                Nombre espacios,            "Nombre solo Regex: ^[a-zA-
COMP Contacto
                persona guiones. -          letras. No   ZáéíóúñÁÉÍÓÚÑ\s-]{3,10
-01  (nombre)
                contacto. Longitud 3-       números."    0}$
                          100. - Como
                          nombre
                          producto.
                          -
                          Obligatorio.
                          - 8 dígitos       "Teléfono: 8
COMP            Número (Bolivia). -         números.
     Teléfono                                            Regex: ^\d{8}$
-01             teléfono. Solo              Ejemplo:
                          números. -        77777777."
                          Ejemplo:
                          77777777.
                          -
                          Obligatorio.
                                            "Dirección
                          - Letras,
COMP            Dirección                   debe ser real,
     Dirección            números,                         Regex: ^[\w\s.-,]{10,200}$
-01             completa.                   máximo 200
                          espacios, ., -.
                                            letras."
                          - Longitud
                          10-200.
                          - Cantidades
                                            "Cantidad
                          >0. - No si
                                            debe ser
COMP Órdenes Generar stock ya
                                            positiva.    if (cantidad <=0) { error; }
-02  de compra pedido.    alto. -
                                            Proveedor no
                          Proveedor
                                            encontrado."
                          existe.
                          - Cantidad
                          >0. - Fecha
                                            "Cantidad
     Ingreso de           vencimiento
COMP            Agregar                     positiva.     stock += cantidad; if (fecha
     mercaderí            válida si
-03             stock.                      Fecha         invalid) { error; }
     a                    perecedero. -
                                            futura."
                          Automático
                          stock +.
 Códig              Qué es / Cómo            Mensaje de
         Campo                                                  Código sugerido
   o                Por qué validar            error
                         - Confirmar.
                         - Stock no
                         negativo           "Explica el
     Devolució
COMP           Restar    después. -         motivo. Stock if (stock - cantidad <0)
     na
-04            stock.    Motivo             no puede      { error; }
     proveedor
                         obligatorio        bajar de 0."
                         (texto 10-
                         200).
                         - Fechas
                                            "Fecha desde
     Historial           válidas (no
COMP                                        < hasta.
     de        Consulta. futuras). -                     if (desde > hasta) { error; }
-05                                         Proveedor
     compras             Proveedor
                                            correcto."
                         existe.


3. Ventas / Punto de Venta (VENT-01 a VENT-06)
Para ventas en caja. Muy importante para no vender sin stock.

                         Qué es /                           Mensaje de       Código
Código     Campo                        Cómo validar
                         Por qué                               error        sugerido
                                                            "Producto
                                                            no
                                    - Producto existe. -                   if (cantidad
VENT-              Buscar                                   encontrado.
      Venta rápida                  Cantidad <= stock. - No                > stock)
01                 producto.                                Solo quedan
                                    cero.                                  { error; }
                                                            X
                                                            unidades."
                                    - Automática            "Factura no
                                                                           Auto-
VENT-                  Emitir       correlativa. - Cumple   generada.
      Facturación                                                          incremento
02                     factura.     SIN Bolivia. - Cajero   Revisa
                                                                           en BD.
                                    identificado.           conexión."
                                    - Efectivo: positivo. - "Tarjeta: 16
                                    Tarjeta: 16 dígitos. -  números.       Regex
VENT- Medios de        Forma
                                    Suma = total. -         Suma debe      tarjeta:
03    pago             pago.
                                    Ejemplo: Tarjeta        igualar        ^\d{16}$
                                    "4111111111111111". total."
                                                                      if
                                                         "Dinero no
                                    - No discrepancias sin            (efectivo !=
VENT- Cierre de    Corte                                 cuadra.
                                    motivo. - Fechas                  calculado)
05    caja         turno.                                Explica
                                    válidas.                          { pedir
                                                         diferencia."
                                                                      motivo; }
                                                         "Venta no
                              - Venta original existe. -
VENT-                                                    encontrada. stock +=
      Devoluciones Reembolso. Stock + no excede. -
06                                                       Motivo       devuelto;
                              Motivo 10-200 letras.
                                                         requerido."
4. Clientes (CLI-01 a CLI-06)
Para datos clientes. Cumple protección datos (NF-11).

 Códi          Qué es /                       Mensaje de
         Campo            Cómo validar                            Código sugerido
  go            Por qué                         error
                         - Obligatorio. -
                                             "Nombre solo
                         Solo letras,                       Regex: ^[a-zA-
CLI- Nombre Nombre                           letras.
                         espacios,                          ZáéíóúñÁÉÍÓÚÑ\s-]{3,
01   completo cliente.                       Ejemplo: 'Juan
                         guiones. - 3-                      100}$
                                             Pérez'."
                         100.
                         - Obligatorio. -
                         CI: 7-11 dígitos
                                             "CI: 7-11
CLI-           Docume + letra                              Regex CI: ^\d{7,11}[A-
     CI/NIT                                  números. NIT:
01             nto ID. opcional. - NIT:                    Z]?$
                                             11 números."
                         11 dígitos. -
                         Único.
CLI-                     - Opcional. - 8                      Regex: ^\d{8}$?
     Teléfono Teléfono.                      "8 números."
01                       dígitos.                             (opcional)
                         - Opcional. -       "Email
                         Formato             inválido.     Regex:
CLI-
     Correo    Email.    user@domain.c       Ejemplo:      ^[\w.-]+@[\w.-]+.\w{2,4
01
                         om. - No            juan@gmail.co }$
                         duplicado.          m."
                         - Cliente existe.
CLI-                                         "Cliente no
     Historial Consulta. - Fechas                             Chequeo BD.
02                                           encontrado."
                         válidas.
                         - Como
CLI-           Cambiar                       "No duplicados
     Edición             registro. -                        Similar a PROD-02.
05             datos.                        en CI."
                         Auditoría.
                                        "No borrar con
CLI- Eliminaci Desactiv - No si compras                if (compras >0)
                                        compras
06   ón lógica ar.      abiertas.                      { error; }
                                        pendientes."


5. Inventario (INV-01 a INV-04)
Control stock. Automático mucho.

                          Qué es / Por      Cómo          Mensaje de       Código
Código       Campo
                             qué           validar          error         sugerido
                                        - Automáticos
INV-                                                     "Movimiento Transacción
         Entradas/salidas Movimientos. >0 o <0. -
01                                                       inválido."  BD.
                                        Atómicos.
                                        - Motivo         "Explica      if
INV-
         Ajustes stock    Correcciones. obligatorio. -   motivo. Stock (nuevo_stock
02
                                        No negativo.     >=0."         <0) { error; }
                          Qué es / Por       Cómo         Mensaje de    Código
Código       Campo
                             qué            validar         error      sugerido
                                                                   if (stock <
INV-                                   - Automática "Alerta: Stock minimo)
         Alertas stock   Notificación.
03                                     si < mínimo. bajo."         { enviar
                                                                   email; }
                                       - Fecha > hoy.
INV-     Productos por                                "Fecha       Calcular días =
                         Reporte.      - Reporte días
04       vencer                                       pasada."     fecha - hoy.
                                       >0.


6. Recursos Humanos (RH-01 a RH-06)
Para empleados. Como clientes pero con foto.

                           Qué es / Por                       Mensaje de        Código
Código        Campo                         Cómo validar
                              qué                               error          sugerido
                                          - Obligatorio. -
                          Datos                               "Nombre         Igual que
RH-01 Nombre/Apellido                     Solo letras, etc. -
                          personales.                         solo letras."   CLI-01.
                                          3-100.
                                                              "Elige
                                          - Obligatorio. -
RH-01 Cargo               Puesto.                             cargo de        Dropdown.
                                          Lista: cajero, etc.
                                                              lista."
                                                              "Fecha          if (fecha >
RH-01 Fecha ingreso       Fecha entrada. - No futura.         pasada o        hoy)
                                                              hoy."           { error; }
                                          - Obligatorio, 8 "8                 Regex:
RH-01 Teléfono            Teléfono.
                                          dígitos.            números."       ^\d{8}$
                                          - JPEG/PNG. -       "Foto           Chequeo
                          Imagen
RH-01 Foto                                <2MB. -             inválida o      tamaño
                          empleado.
                                          Opcional.           grande."        archivo.
                                          - Hora HH:MM. -                     if (salida <
                                                              "Hora
RH-02 Asistencia          Entrada/salida. No                                  entrada)
                                                              inválida."
                                          superposiciones.                    { error; }
                                          - Basado en         "Rol no         Asignar por
RH-03 Roles               Accesos.
                                          perfiles.           permitido."     admin.
RH-05 Edición             Cambiar.        - Auditoría.        Similar.        Igual.
                                                              "No borrar
                                          - No asistencia                     Chequeo
RH-06 Eliminación         Desactivar.                         con
                                          pendiente.                          BD.
                                                              registros."


7. Seguridad (SEG-01 a SEG-03)
Para usuarios y logs.
                       Qué
 Códig                 es /        Cómo         Mensaje de
           Campo                                                      Código sugerido
   o                   Por        validar         error
                       qué
                               -
                               Obligatorio,    "Usuario 5-20
SEG-                   Login
          Usuario              único. - 5-20   letras/números. Regex: ^[a-zA-Z0-9]{5,20}$
01                     .
                               alfanumérico    "
                               .
                               - 8+ chars,
                               mayús,
                                               "Contraseña    Regex: ^(?=.[A-Z])(?=.[a-
SEG-      Contraseñ Clave      minús,
                                               débil. Usa 8+ z])(?=.\d)(?=.[@!!%*?&]{8,
01        a         .          número,
                                               con variedad." }$
                               símbolo. -
                               Encriptada.
SEG-                   Roles   - Selección     "Rol no
          Perfiles                                              Dropdown por admin.
02                     .       restringida.    disponible."
                               -
SEG-                                           N/A
          Auditoría Logs.      Automática,                      INSERT INTO logs siempre.
03                                             (automático).
                               no editable.


8. Reportes y Estadísticas (REP-01 a REP-04)
Para consultas.

                               Qué es /                      Mensaje de       Código
Código        Campo                         Cómo validar
                               Por qué                          error        sugerido
                                                            "Rango
REP-                                      - Fechas válidas,             if (rango >365
          Ventas diarias Filtros.                           máximo 1
01                                        <1 año.                       días) { error; }
                                                            año."
REP-      Productos                       - Cantidad/valor              Ordenar por
                           Ranking.                         N/A.
02        vendidos                        >0.                           SQL.
                                                            "Costo >    if (costo >=
REP-
          Rentabilidad     Margen.        - Costo < venta. venta,       venta)
03
                                                            pérdida."   { alerta; }
REP-
          Inventario       Reporte.       - Stock >=0.         N/A.         Filtrar SQL.
04


Validaciones Generales No Funcionales (NF-01 a NF-
22)
   •     Usabilidad: Mensajes claros, interfaz simple (botones grandes).
   •     Seguridad: Timeout 15 min, 2FA admins.
   •     Integridad: No ventas sin stock (NF-13).
   •     Backup: Automático diario.
